<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>lccml API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="index.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;
                Module Index
            </a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#system">system</a>
            </li>
            <li>
                    <a class="variable" href="#current_directory">current_directory</a>
            </li>
            <li>
                    <a class="class" href="#LCCML">LCCML</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#LCCML.__init__">LCCML</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCCML.random_seed">random_seed</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCCML.rng">rng</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCCML.model">model</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCCML.n_chains">n_chains</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCCML.orders">orders</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCCML.chains">chains</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCCML.chain_train_times">chain_train_times</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCCML.train_time_total">train_time_total</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCCML.test_time_total">test_time_total</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCCML.chain_model_sizes">chain_model_sizes</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCCML.total_model_size">total_model_size</a>
                        </li>
                        <li>
                                <a class="function" href="#LCCML.fit">fit</a>
                        </li>
                        <li>
                                <a class="function" href="#LCCML.predict">predict</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
lccml    </h1>

                
                        <input id="mod-lccml-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-lccml-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1">##############################################################################</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1"># LABEL CLUSTERS CHAINS FOR MULTILABEL CLASSIFICATION                        #</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="c1"># Copyright (C) 2025                                                         #</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="c1">#                                                                            #</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="c1"># This code is free software: you can redistribute it and/or modify it under #</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="c1"># the terms of the GNU General Public License as published by the Free       #</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="c1"># Software Foundation, either version 3 of the License, or (at your option)  #</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="c1"># any later version. This code is distributed in the hope that it will be    #</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="c1"># useful, but WITHOUT ANY WARRANTY; without even the implied warranty of     #</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General   #</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="c1"># Public License for more details.                                           #</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="c1">#                                                                            #</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="c1"># Prof. Elaine Cecilia Gatto - UFLA - Lavras, Minas Gerais, Brazil           #</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="c1"># Prof. Ricardo Cerri - USP - São Carlos, São Paulo, Brazil                  #</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="c1"># Prof. Mauri Ferrandin - UFSC - Blumenau, Santa Catarina, Brazil            #</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="c1"># Prof. Celine Vens - Ku Leuven - Kortrijik, West Flanders, Belgium          #</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="c1"># PhD Felipe Nakano Kenji - Ku Leuven - Kortrijik, West Flanders, Belgium    #</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="c1">#                                                                            #</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="c1"># BIOMAL - http://www.biomal.ufscar.br                                       #</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="c1">#                                                                            #</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="c1">##############################################################################</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">platform</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="n">system</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span><span class="p">:</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>    <span class="n">user_profile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;USERPROFILE&#39;</span><span class="p">]</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>    <span class="n">FolderRoot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">user_profile</span><span class="p">,</span> <span class="s1">&#39;Documents&#39;</span><span class="p">,</span> <span class="s1">&#39;MultiLabelEvaluationMetrics&#39;</span><span class="p">,</span> <span class="s1">&#39;src&#39;</span><span class="p">)</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="k">elif</span> <span class="n">system</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Linux&#39;</span><span class="p">,</span> <span class="s1">&#39;Darwin&#39;</span><span class="p">]:</span>  <span class="c1"># &#39;Darwin&#39; is the system name for macOS</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>    <span class="n">FolderRoot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/LCCML/src&#39;</span><span class="p">)</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="k">else</span><span class="p">:</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unsupported operating system&#39;</span><span class="p">)</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">FolderRoot</span><span class="p">)</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="n">current_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">joblib</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">clone</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="k">class</span><span class="w"> </span><span class="nc">LCCML</span><span class="p">:</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    Label Clusters Chains for Multi-Label Classification (LCCML).</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    The algorithm trains an ensemble of classifier chains, where each chain</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">    operates on a random permutation of label clusters. Each cluster can contain </span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    one or multiple labels. The prediction of previous clusters is added as input </span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">    for subsequent clusters in the chain.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">    Additional features implemented:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    - Measures training time per chain and total training time.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">    - Measures model size per chain and total model size in memory (without disk I/O).</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">    - Measures total prediction time.</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    Parameters</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">    ----------</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">    model : sklearn-like estimator</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">        Base classifier to be used for each cluster.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">    </span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">    n_chains : int, default=10</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        Number of chains in the ensemble.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">    Attributes</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">    ----------</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">    orders : list</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">        Stores the random order of clusters for each chain.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">    </span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">    chains : list</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">        Trained chains (list of models per chain).</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">    </span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">    chain_train_times : list</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">        Training time for each chain.</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">    </span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">    train_time_total : float</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">        Total training time.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">    </span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    chain_model_sizes : list</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">        Size (in bytes) of each chain (in memory).</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">    </span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">    total_model_size : int</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">        Total size (sum of all chains).</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">    </span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    test_time_total : float</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        Accumulated total prediction time.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">    Example of Usage</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">    ----------------</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">    from sklearn.ensemble import RandomForestClassifier</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">    model_base = RandomForestClassifier()</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">    </span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">    lccml = LCCML(model=model_base, n_chains=10)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">    clusters = [[&#39;label1&#39;, &#39;label2&#39;], [&#39;label3&#39;], [&#39;label4&#39;, &#39;label5&#39;]]</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">    lccml.fit(X_train, Y_train, clusters)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">    </span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">    Y_pred = lccml.predict(X_test)</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">    print(&quot;Total training time:&quot;, lccml.train_time_total)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">    </span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">    print(&quot;Training times per chain:&quot;, lccml.chain_train_times)</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">    </span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">    print(&quot;Model sizes (bytes):&quot;, lccml.chain_model_sizes)</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">    </span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">    print(&quot;Total model size (bytes):&quot;, lccml.total_model_size)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">    </span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">    print(&quot;Total prediction time:&quot;, lccml.test_time_total)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>    <span class="n">random_seed</span> <span class="o">=</span> <span class="mi">1234</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="c1">#                                                 #</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">n_chains</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>             
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>          
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span> <span class="o">=</span> <span class="n">n_chains</span>    
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">orders</span> <span class="o">=</span> <span class="kc">None</span>         
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chains</span> <span class="o">=</span> <span class="p">[]</span>           
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chain_train_times</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_time_total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_time_total</span> <span class="o">=</span> <span class="mi">0</span> 
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chain_model_sizes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_model_size</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>    <span class="c1">#                                                 #</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">clusters</span><span class="p">):</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">        Train the ensemble of label clusters chains.</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">        This method trains multiple classifier chains. Each chain follows a random </span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">        permutation of the provided label clusters. The model uses the predictions </span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        of previous clusters as additional features when training subsequent clusters.</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">        Parameters</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">        ----------</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">        x : pd.DataFrame</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">            Feature matrix of shape (n_samples, n_features).</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">        </span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">        y : pd.DataFrame</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">            Multi-label target matrix of shape (n_samples, n_labels), where columns correspond to label names.</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">        </span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">        clusters : list of list of str</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">            Each sublist contains the names of labels belonging to one cluster.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">            Example: [[&#39;label1&#39;, &#39;label2&#39;], [&#39;label3&#39;], [&#39;label4&#39;, &#39;label5&#39;]].</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">        Returns</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        -------</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">        None</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">        Example</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        -------</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestClassifier</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        &gt;&gt;&gt; model = RandomForestClassifier()</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=model, n_chains=5)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">        &gt;&gt;&gt; # Suppose X_train is a pandas DataFrame of features, and Y_train is a pandas DataFrame of labels</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">        &gt;&gt;&gt; clusters = [[&#39;label_a&#39;, &#39;label_b&#39;], [&#39;label_c&#39;], [&#39;label_d&#39;, &#39;label_e&#39;]]</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        &gt;&gt;&gt; lccml.fit(X_train, Y_train, clusters)</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        After fitting, you can access:</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        &gt;&gt;&gt; lccml.train_time_total  # total training time</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">        &gt;&gt;&gt; lccml.chain_train_times # list of training times per chain</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">        &gt;&gt;&gt; lccml.total_model_size  # total model size (bytes)</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__generateOrders</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">))</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__preprocessClustersName</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>        
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span><span class="p">):</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__fitChain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orders</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_time_total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_train_times</span><span class="p">)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_model_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_model_sizes</span><span class="p">)</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>    
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>    
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>    <span class="c1">#                                                 #</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__generateOrders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_clusters</span><span class="p">):</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">        Generate random permutations of cluster orders for each chain.</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">        Each chain will follow a different random order of clusters, ensuring</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">        diversity across the ensemble of label clusters chains. The generated orders</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">        are stored in self.orders as a list of numpy arrays.</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">        Parameters</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">        ----------</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">        n_clusters : int</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">            Total number of clusters.</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">        Returns</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">        -------</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">        None</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        Example</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">        -------</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=RandomForestClassifier(), n_chains=3)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">        &gt;&gt;&gt; lccml.__generateOrders(n_clusters=4)</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">        &gt;&gt;&gt; print(lccml.orders)</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">        [array([2, 1, 3, 0]), array([0, 2, 1, 3]), array([3, 0, 1, 2])]</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">        Each array represents one chain&#39;s cluster processing order.</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">orders</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">n_clusters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span><span class="p">)]</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>    
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>    <span class="c1">#                                                 #</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__fitChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        Train a single label cluster chain following the specified cluster order.</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">        For each cluster in the given order, the corresponding labels are trained </span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">        using the base model. After training on a cluster, its predicted labels are </span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">        appended as additional features for training the next cluster.</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">        The training time and model size of the chain are recorded.</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">        Parameters</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">        ----------</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">        order : array-like of int</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">            A permutation of cluster indices indicating the processing order for this chain.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">        </span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">        x : pd.DataFrame</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">            Feature matrix of shape (n_samples, n_features).</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        </span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">        y : pd.DataFrame</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">            Multi-label target matrix of shape (n_samples, n_labels).</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">        Returns</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">        -------</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">        None</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">        Example</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">        -------</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestClassifier</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">        &gt;&gt;&gt; model = RandomForestClassifier()</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=model, n_chains=1)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">        &gt;&gt;&gt; clusters = [[&#39;label_a&#39;, &#39;label_b&#39;], [&#39;label_c&#39;], [&#39;label_d&#39;, &#39;label_e&#39;]]</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">        &gt;&gt;&gt; lccml.fit(X_train, Y_train, clusters)</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="sd">        &gt;&gt;&gt; # Suppose we manually want to train one chain:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">        &gt;&gt;&gt; order = lccml.orders[0]  # e.g., array([2, 0, 1])</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">        &gt;&gt;&gt; lccml.__fitChain(order, X_train, Y_train)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">        After execution:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">        &gt;&gt;&gt; lccml.chains[-1]  # last trained chain (list of trained models)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">        &gt;&gt;&gt; lccml.chain_train_times[-1]  # training time of this chain</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">        &gt;&gt;&gt; lccml.chain_model_sizes[-1]  # model size (bytes) of this chain</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="n">chain_X</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>        <span class="n">chain</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">orderLabelsDataset</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">columns</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="n">cluster_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="n">chainModel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getModel</span><span class="p">()</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="n">chain_Y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">cluster_labels</span><span class="p">]])</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>            <span class="n">chainModel</span><span class="o">.</span><span class="n">labelName_</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">cluster_labels</span><span class="p">]</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>            <span class="k">if</span> <span class="n">chain_Y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>                <span class="n">chainModel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">chain_X</span><span class="p">,</span> <span class="n">chain_Y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>                <span class="n">chainModel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">chain_X</span><span class="p">,</span> <span class="n">chain_Y</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="n">chain_X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">chain_X</span><span class="p">,</span> <span class="n">chain_Y</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>            <span class="n">chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chainModel</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chain_train_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="n">model_bytes</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="n">model_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_bytes</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chain_model_sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_size</span><span class="p">)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>    <span class="c1">#                                                 #</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__predictChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">chainIndex</span><span class="p">):</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">        Predict using a single label cluster chain of the ensemble.</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">        For the specified chain, the model sequentially predicts the probabilistic outputs</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">        of each cluster, using the predictions of previous clusters as additional features </span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">        for subsequent clusters.</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        Parameters</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">        ----------</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">        x : pd.DataFrame</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">            Feature matrix of shape (n_samples, n_features).</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">        </span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">        chainIndex : int</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">            Index of the chain to use for prediction (from 0 to n_chains - 1).</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">        Returns</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        -------</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">            Predicted probabilities for all labels from this chain.</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">            The columns are aligned to the original label set used during training.</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">        Example</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">        -------</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestClassifier</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">        &gt;&gt;&gt; model = RandomForestClassifier()</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=model, n_chains=3)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">        &gt;&gt;&gt; clusters = [[&#39;label_a&#39;, &#39;label_b&#39;], [&#39;label_c&#39;], [&#39;label_d&#39;]]</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">        &gt;&gt;&gt; lccml.fit(X_train, Y_train, clusters)</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">        &gt;&gt;&gt; # Predict using only chain 0</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">        &gt;&gt;&gt; pred_chain_0 = lccml.__predictChain(X_test, chainIndex=0)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">        &gt;&gt;&gt; print(pred_chain_0.shape)  # (n_samples, n_labels)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">        Notes</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">        -----</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">        - The method outputs probabilities, not binary predictions.</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">        - Used internally by `predict()`, which averages predictions across chains.</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="n">chain_X</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>        <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">chainIndex</span><span class="p">]:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>            <span class="n">pred_proba</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">chain_X</span><span class="p">)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pred_proba</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>                <span class="n">pred_proba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>                    <span class="p">[</span><span class="n">probs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">probs</span> <span class="ow">in</span> <span class="n">pred_proba</span><span class="p">],</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>                <span class="p">)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>                <span class="n">pred_proba</span> <span class="o">=</span> <span class="n">pred_proba</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>            <span class="n">pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred_proba</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">labelName_</span><span class="p">)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>            <span class="n">predictions</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">labelName_</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_df</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>            <span class="c1"># Atualiza as features com as predições do cluster atual</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>            <span class="n">chain_X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">chain_X</span><span class="p">,</span> <span class="n">pred_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>        <span class="c1"># Ordena as colunas de acordo com as labels originais</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>        <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">orderLabelsDataset</span><span class="p">]</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>        <span class="k">return</span> <span class="n">predictions</span>    
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>          
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>    <span class="c1">#                                                 #</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>    <span class="c1"># ----------------------------------------------- # </span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__getModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">        Clone the base classifier.</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">        This method creates a new independent instance of the base model provided</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">        during the initialization of the LCCML object. It ensures that each model </span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">        in the chain is trained independently and avoids parameter sharing </span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">        between chains or clusters.</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">        Returns</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">        -------</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">        sklearn-like estimator</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">            A fresh copy of the base classifier, ready to be trained.</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">        Example</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        -------</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestClassifier</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">        &gt;&gt;&gt; model = RandomForestClassifier(n_estimators=100)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=model, n_chains=5)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">        </span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">        &gt;&gt;&gt; cloned_model = lccml.__getModel()</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        &gt;&gt;&gt; cloned_model.fit(X_train, Y_train)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">        &gt;&gt;&gt; predictions = cloned_model.predict(X_test)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        </span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">        Notes</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">        -----</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">        - Internally uses `sklearn.base.clone` to copy hyperparameters and structure.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">        - This method ensures no data leakage or unintended parameter sharing across models.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="k">return</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>    
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>    <span class="c1">#                                                 #</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__preprocessClustersName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">        Convert cluster label names to column indices.</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">        This function maps each label name inside the provided clusters into the corresponding </span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">        column indices of the label matrix Y. Internally, all clusters are stored as index </span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">        positions for efficient access during training and prediction.</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">        Parameters</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">        ----------</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">        clusters : list of lists of str</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">            Each sublist contains label names that belong to a cluster. </span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">            Example: [[&#39;label_a&#39;, &#39;label_b&#39;], [&#39;label_c&#39;], [&#39;label_d&#39;, &#39;label_e&#39;]]</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">        </span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">        Y : pd.DataFrame</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">            The multi-label target matrix where columns are label names.</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">        Returns</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">        -------</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">        list of lists of int</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">            The clusters with label indices instead of names. Each sublist contains </span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">            the integer indices of the labels in the Y columns.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a><span class="sd">        Example</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="sd">        -------</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">        &gt;&gt;&gt; Y = pd.DataFrame(columns=[&#39;label_a&#39;, &#39;label_b&#39;, &#39;label_c&#39;, &#39;label_d&#39;])</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">        &gt;&gt;&gt; clusters = [[&#39;label_a&#39;, &#39;label_b&#39;], [&#39;label_c&#39;], [&#39;label_d&#39;]]</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=SomeClassifier())</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="sd">        &gt;&gt;&gt; cluster_indices = lccml.__preprocessClustersName(clusters, Y)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">        &gt;&gt;&gt; print(cluster_indices)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a><span class="sd">        [[0, 1], [2], [3]]</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="sd">        Notes</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">        -----</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">        - The column indices are necessary for efficient internal processing.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">        - This function assumes that all provided label names exist as columns in Y.</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">        - Raises `KeyError` if any label name is not found in Y.</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>        <span class="n">clustersIndexes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>            <span class="p">[</span><span class="n">Y</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cluster_labels</span><span class="p">]</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>            <span class="k">for</span> <span class="n">cluster_labels</span> <span class="ow">in</span> <span class="n">clusters</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>        <span class="p">]</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>        <span class="k">return</span> <span class="n">clustersIndexes</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>    
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>    <span class="c1">#                                                 #</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">        Performs model prediction by aggregating the results from multiple chains.</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">        For each chain, the model sequentially predicts the clusters according to its specific order.</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">        The individual predictions from all chains are aggregated by averaging the predictions </span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">        across chains for each label. This produces probabilistic predictions for each label.</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">        Parameters</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">        ----------</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">        x : pd.DataFrame</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">            DataFrame containing the input data (features) for prediction.</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">            Shape: (n_samples, n_features)</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="sd">        Returns</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">        -------</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="sd">            DataFrame containing the aggregated predicted probabilities for each label.</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">            Shape: (n_samples, n_labels)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">            The columns match the label names used during training.</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="sd">        Example</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">        -------</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestClassifier</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="sd">        &gt;&gt;&gt; model = RandomForestClassifier()</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=model, n_chains=5)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">        &gt;&gt;&gt; clusters = [[&#39;label_a&#39;, &#39;label_b&#39;], [&#39;label_c&#39;], [&#39;label_d&#39;, &#39;label_e&#39;]]</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">        &gt;&gt;&gt; lccml.fit(X_train, Y_train, clusters)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">        &gt;&gt;&gt; Y_pred = lccml.predict(X_test)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">        &gt;&gt;&gt; print(Y_pred.head())</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">        amazed.suprised  happy.pleased  relaxing.calm  quiet.still  ... angry.aggresive</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">        Notes</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">        -----</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        - The aggregation is performed by computing the mean across predictions from all chains.</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">        - In case of any error during prediction, an exception will be printed.</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="c1"># Performs predictions for each of the chains, using __predictChain for each chain index (0 to n_chains-1)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>        <span class="c1"># The result of each chain is concatenated along axis 0 (stacked vertically).</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="c1"># predictions = pd.concat([self.__predictChain(x, i) for i in range(self.n_chains)], axis=0)        </span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>            <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">__predictChain</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>            <span class="c1"># print(&quot;PREDICTIONS INSIDE PREDICT 2 before applying the mean&quot;)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>            <span class="c1"># print(predictions)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>        
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>        <span class="n">predictions_aggregated</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="c1"># print(&quot;AGGREGATED PREDICTIONS:&quot;)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="c1"># print(predictions_aggregated)</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="c1"># Now, for each class (column) in the DataFrame, compute the mean of the </span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>        <span class="c1"># predictions for each group of examples (rows)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>        <span class="c1"># We group by rows (index), and for each group (class), apply the mean        </span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>        <span class="c1"># return predictions.groupby(predictions.index).apply(np.mean)</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>        <span class="c1"># predictions.mean(axis=0)  # Computes the mean per label (column)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>        <span class="c1"># Now, for each sample, we select the highest prediction across chains</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>        <span class="c1"># We group by samples (index), and for each group (class), apply the max</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>        <span class="c1"># predictions_aggregated = predictions.groupby(predictions.index).max()</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>        <span class="k">return</span> <span class="n">predictions_aggregated</span>
</span></pre></div>


            </section>
                <section id="system">
                    <div class="attr variable">
            <span class="name">system</span>        =
<span class="default_value">&#39;Linux&#39;</span>

        
    </div>
    <a class="headerlink" href="#system"></a>
    
    

                </section>
                <section id="current_directory">
                    <div class="attr variable">
            <span class="name">current_directory</span>        =
<span class="default_value">$PYTHONPATH</span>

        
    </div>
    <a class="headerlink" href="#current_directory"></a>
    
    

                </section>
                <section id="LCCML">
                            <input id="LCCML-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LCCML</span>:

                <label class="view-source-button" for="LCCML-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCCML"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCCML-51"><a href="#LCCML-51"><span class="linenos"> 51</span></a><span class="k">class</span><span class="w"> </span><span class="nc">LCCML</span><span class="p">:</span>
</span><span id="LCCML-52"><a href="#LCCML-52"><span class="linenos"> 52</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCCML-53"><a href="#LCCML-53"><span class="linenos"> 53</span></a><span class="sd">    Label Clusters Chains for Multi-Label Classification (LCCML).</span>
</span><span id="LCCML-54"><a href="#LCCML-54"><span class="linenos"> 54</span></a>
</span><span id="LCCML-55"><a href="#LCCML-55"><span class="linenos"> 55</span></a><span class="sd">    The algorithm trains an ensemble of classifier chains, where each chain</span>
</span><span id="LCCML-56"><a href="#LCCML-56"><span class="linenos"> 56</span></a><span class="sd">    operates on a random permutation of label clusters. Each cluster can contain </span>
</span><span id="LCCML-57"><a href="#LCCML-57"><span class="linenos"> 57</span></a><span class="sd">    one or multiple labels. The prediction of previous clusters is added as input </span>
</span><span id="LCCML-58"><a href="#LCCML-58"><span class="linenos"> 58</span></a><span class="sd">    for subsequent clusters in the chain.</span>
</span><span id="LCCML-59"><a href="#LCCML-59"><span class="linenos"> 59</span></a>
</span><span id="LCCML-60"><a href="#LCCML-60"><span class="linenos"> 60</span></a><span class="sd">    Additional features implemented:</span>
</span><span id="LCCML-61"><a href="#LCCML-61"><span class="linenos"> 61</span></a><span class="sd">    - Measures training time per chain and total training time.</span>
</span><span id="LCCML-62"><a href="#LCCML-62"><span class="linenos"> 62</span></a><span class="sd">    - Measures model size per chain and total model size in memory (without disk I/O).</span>
</span><span id="LCCML-63"><a href="#LCCML-63"><span class="linenos"> 63</span></a><span class="sd">    - Measures total prediction time.</span>
</span><span id="LCCML-64"><a href="#LCCML-64"><span class="linenos"> 64</span></a>
</span><span id="LCCML-65"><a href="#LCCML-65"><span class="linenos"> 65</span></a><span class="sd">    Parameters</span>
</span><span id="LCCML-66"><a href="#LCCML-66"><span class="linenos"> 66</span></a><span class="sd">    ----------</span>
</span><span id="LCCML-67"><a href="#LCCML-67"><span class="linenos"> 67</span></a><span class="sd">    model : sklearn-like estimator</span>
</span><span id="LCCML-68"><a href="#LCCML-68"><span class="linenos"> 68</span></a><span class="sd">        Base classifier to be used for each cluster.</span>
</span><span id="LCCML-69"><a href="#LCCML-69"><span class="linenos"> 69</span></a><span class="sd">    </span>
</span><span id="LCCML-70"><a href="#LCCML-70"><span class="linenos"> 70</span></a><span class="sd">    n_chains : int, default=10</span>
</span><span id="LCCML-71"><a href="#LCCML-71"><span class="linenos"> 71</span></a><span class="sd">        Number of chains in the ensemble.</span>
</span><span id="LCCML-72"><a href="#LCCML-72"><span class="linenos"> 72</span></a>
</span><span id="LCCML-73"><a href="#LCCML-73"><span class="linenos"> 73</span></a><span class="sd">    Attributes</span>
</span><span id="LCCML-74"><a href="#LCCML-74"><span class="linenos"> 74</span></a><span class="sd">    ----------</span>
</span><span id="LCCML-75"><a href="#LCCML-75"><span class="linenos"> 75</span></a><span class="sd">    orders : list</span>
</span><span id="LCCML-76"><a href="#LCCML-76"><span class="linenos"> 76</span></a><span class="sd">        Stores the random order of clusters for each chain.</span>
</span><span id="LCCML-77"><a href="#LCCML-77"><span class="linenos"> 77</span></a><span class="sd">    </span>
</span><span id="LCCML-78"><a href="#LCCML-78"><span class="linenos"> 78</span></a><span class="sd">    chains : list</span>
</span><span id="LCCML-79"><a href="#LCCML-79"><span class="linenos"> 79</span></a><span class="sd">        Trained chains (list of models per chain).</span>
</span><span id="LCCML-80"><a href="#LCCML-80"><span class="linenos"> 80</span></a><span class="sd">    </span>
</span><span id="LCCML-81"><a href="#LCCML-81"><span class="linenos"> 81</span></a><span class="sd">    chain_train_times : list</span>
</span><span id="LCCML-82"><a href="#LCCML-82"><span class="linenos"> 82</span></a><span class="sd">        Training time for each chain.</span>
</span><span id="LCCML-83"><a href="#LCCML-83"><span class="linenos"> 83</span></a><span class="sd">    </span>
</span><span id="LCCML-84"><a href="#LCCML-84"><span class="linenos"> 84</span></a><span class="sd">    train_time_total : float</span>
</span><span id="LCCML-85"><a href="#LCCML-85"><span class="linenos"> 85</span></a><span class="sd">        Total training time.</span>
</span><span id="LCCML-86"><a href="#LCCML-86"><span class="linenos"> 86</span></a><span class="sd">    </span>
</span><span id="LCCML-87"><a href="#LCCML-87"><span class="linenos"> 87</span></a><span class="sd">    chain_model_sizes : list</span>
</span><span id="LCCML-88"><a href="#LCCML-88"><span class="linenos"> 88</span></a><span class="sd">        Size (in bytes) of each chain (in memory).</span>
</span><span id="LCCML-89"><a href="#LCCML-89"><span class="linenos"> 89</span></a><span class="sd">    </span>
</span><span id="LCCML-90"><a href="#LCCML-90"><span class="linenos"> 90</span></a><span class="sd">    total_model_size : int</span>
</span><span id="LCCML-91"><a href="#LCCML-91"><span class="linenos"> 91</span></a><span class="sd">        Total size (sum of all chains).</span>
</span><span id="LCCML-92"><a href="#LCCML-92"><span class="linenos"> 92</span></a><span class="sd">    </span>
</span><span id="LCCML-93"><a href="#LCCML-93"><span class="linenos"> 93</span></a><span class="sd">    test_time_total : float</span>
</span><span id="LCCML-94"><a href="#LCCML-94"><span class="linenos"> 94</span></a><span class="sd">        Accumulated total prediction time.</span>
</span><span id="LCCML-95"><a href="#LCCML-95"><span class="linenos"> 95</span></a>
</span><span id="LCCML-96"><a href="#LCCML-96"><span class="linenos"> 96</span></a><span class="sd">    Example of Usage</span>
</span><span id="LCCML-97"><a href="#LCCML-97"><span class="linenos"> 97</span></a><span class="sd">    ----------------</span>
</span><span id="LCCML-98"><a href="#LCCML-98"><span class="linenos"> 98</span></a><span class="sd">    from sklearn.ensemble import RandomForestClassifier</span>
</span><span id="LCCML-99"><a href="#LCCML-99"><span class="linenos"> 99</span></a>
</span><span id="LCCML-100"><a href="#LCCML-100"><span class="linenos">100</span></a><span class="sd">    model_base = RandomForestClassifier()</span>
</span><span id="LCCML-101"><a href="#LCCML-101"><span class="linenos">101</span></a><span class="sd">    </span>
</span><span id="LCCML-102"><a href="#LCCML-102"><span class="linenos">102</span></a><span class="sd">    lccml = LCCML(model=model_base, n_chains=10)</span>
</span><span id="LCCML-103"><a href="#LCCML-103"><span class="linenos">103</span></a>
</span><span id="LCCML-104"><a href="#LCCML-104"><span class="linenos">104</span></a><span class="sd">    clusters = [[&#39;label1&#39;, &#39;label2&#39;], [&#39;label3&#39;], [&#39;label4&#39;, &#39;label5&#39;]]</span>
</span><span id="LCCML-105"><a href="#LCCML-105"><span class="linenos">105</span></a>
</span><span id="LCCML-106"><a href="#LCCML-106"><span class="linenos">106</span></a><span class="sd">    lccml.fit(X_train, Y_train, clusters)</span>
</span><span id="LCCML-107"><a href="#LCCML-107"><span class="linenos">107</span></a><span class="sd">    </span>
</span><span id="LCCML-108"><a href="#LCCML-108"><span class="linenos">108</span></a><span class="sd">    Y_pred = lccml.predict(X_test)</span>
</span><span id="LCCML-109"><a href="#LCCML-109"><span class="linenos">109</span></a>
</span><span id="LCCML-110"><a href="#LCCML-110"><span class="linenos">110</span></a><span class="sd">    print(&quot;Total training time:&quot;, lccml.train_time_total)</span>
</span><span id="LCCML-111"><a href="#LCCML-111"><span class="linenos">111</span></a><span class="sd">    </span>
</span><span id="LCCML-112"><a href="#LCCML-112"><span class="linenos">112</span></a><span class="sd">    print(&quot;Training times per chain:&quot;, lccml.chain_train_times)</span>
</span><span id="LCCML-113"><a href="#LCCML-113"><span class="linenos">113</span></a><span class="sd">    </span>
</span><span id="LCCML-114"><a href="#LCCML-114"><span class="linenos">114</span></a><span class="sd">    print(&quot;Model sizes (bytes):&quot;, lccml.chain_model_sizes)</span>
</span><span id="LCCML-115"><a href="#LCCML-115"><span class="linenos">115</span></a><span class="sd">    </span>
</span><span id="LCCML-116"><a href="#LCCML-116"><span class="linenos">116</span></a><span class="sd">    print(&quot;Total model size (bytes):&quot;, lccml.total_model_size)</span>
</span><span id="LCCML-117"><a href="#LCCML-117"><span class="linenos">117</span></a><span class="sd">    </span>
</span><span id="LCCML-118"><a href="#LCCML-118"><span class="linenos">118</span></a><span class="sd">    print(&quot;Total prediction time:&quot;, lccml.test_time_total)</span>
</span><span id="LCCML-119"><a href="#LCCML-119"><span class="linenos">119</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="LCCML-120"><a href="#LCCML-120"><span class="linenos">120</span></a>
</span><span id="LCCML-121"><a href="#LCCML-121"><span class="linenos">121</span></a>    <span class="n">random_seed</span> <span class="o">=</span> <span class="mi">1234</span>
</span><span id="LCCML-122"><a href="#LCCML-122"><span class="linenos">122</span></a>    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
</span><span id="LCCML-123"><a href="#LCCML-123"><span class="linenos">123</span></a>
</span><span id="LCCML-124"><a href="#LCCML-124"><span class="linenos">124</span></a>
</span><span id="LCCML-125"><a href="#LCCML-125"><span class="linenos">125</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-126"><a href="#LCCML-126"><span class="linenos">126</span></a>    <span class="c1">#                                                 #</span>
</span><span id="LCCML-127"><a href="#LCCML-127"><span class="linenos">127</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-128"><a href="#LCCML-128"><span class="linenos">128</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">n_chains</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>             
</span><span id="LCCML-129"><a href="#LCCML-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>          
</span><span id="LCCML-130"><a href="#LCCML-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span> <span class="o">=</span> <span class="n">n_chains</span>    
</span><span id="LCCML-131"><a href="#LCCML-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">orders</span> <span class="o">=</span> <span class="kc">None</span>         
</span><span id="LCCML-132"><a href="#LCCML-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chains</span> <span class="o">=</span> <span class="p">[]</span>           
</span><span id="LCCML-133"><a href="#LCCML-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chain_train_times</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCCML-134"><a href="#LCCML-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_time_total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LCCML-135"><a href="#LCCML-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_time_total</span> <span class="o">=</span> <span class="mi">0</span> 
</span><span id="LCCML-136"><a href="#LCCML-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chain_model_sizes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCCML-137"><a href="#LCCML-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_model_size</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LCCML-138"><a href="#LCCML-138"><span class="linenos">138</span></a>
</span><span id="LCCML-139"><a href="#LCCML-139"><span class="linenos">139</span></a>
</span><span id="LCCML-140"><a href="#LCCML-140"><span class="linenos">140</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-141"><a href="#LCCML-141"><span class="linenos">141</span></a>    <span class="c1">#                                                 #</span>
</span><span id="LCCML-142"><a href="#LCCML-142"><span class="linenos">142</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-143"><a href="#LCCML-143"><span class="linenos">143</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">clusters</span><span class="p">):</span>
</span><span id="LCCML-144"><a href="#LCCML-144"><span class="linenos">144</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCCML-145"><a href="#LCCML-145"><span class="linenos">145</span></a><span class="sd">        Train the ensemble of label clusters chains.</span>
</span><span id="LCCML-146"><a href="#LCCML-146"><span class="linenos">146</span></a>
</span><span id="LCCML-147"><a href="#LCCML-147"><span class="linenos">147</span></a><span class="sd">        This method trains multiple classifier chains. Each chain follows a random </span>
</span><span id="LCCML-148"><a href="#LCCML-148"><span class="linenos">148</span></a><span class="sd">        permutation of the provided label clusters. The model uses the predictions </span>
</span><span id="LCCML-149"><a href="#LCCML-149"><span class="linenos">149</span></a><span class="sd">        of previous clusters as additional features when training subsequent clusters.</span>
</span><span id="LCCML-150"><a href="#LCCML-150"><span class="linenos">150</span></a>
</span><span id="LCCML-151"><a href="#LCCML-151"><span class="linenos">151</span></a><span class="sd">        Parameters</span>
</span><span id="LCCML-152"><a href="#LCCML-152"><span class="linenos">152</span></a><span class="sd">        ----------</span>
</span><span id="LCCML-153"><a href="#LCCML-153"><span class="linenos">153</span></a><span class="sd">        x : pd.DataFrame</span>
</span><span id="LCCML-154"><a href="#LCCML-154"><span class="linenos">154</span></a><span class="sd">            Feature matrix of shape (n_samples, n_features).</span>
</span><span id="LCCML-155"><a href="#LCCML-155"><span class="linenos">155</span></a><span class="sd">        </span>
</span><span id="LCCML-156"><a href="#LCCML-156"><span class="linenos">156</span></a><span class="sd">        y : pd.DataFrame</span>
</span><span id="LCCML-157"><a href="#LCCML-157"><span class="linenos">157</span></a><span class="sd">            Multi-label target matrix of shape (n_samples, n_labels), where columns correspond to label names.</span>
</span><span id="LCCML-158"><a href="#LCCML-158"><span class="linenos">158</span></a><span class="sd">        </span>
</span><span id="LCCML-159"><a href="#LCCML-159"><span class="linenos">159</span></a><span class="sd">        clusters : list of list of str</span>
</span><span id="LCCML-160"><a href="#LCCML-160"><span class="linenos">160</span></a><span class="sd">            Each sublist contains the names of labels belonging to one cluster.</span>
</span><span id="LCCML-161"><a href="#LCCML-161"><span class="linenos">161</span></a><span class="sd">            Example: [[&#39;label1&#39;, &#39;label2&#39;], [&#39;label3&#39;], [&#39;label4&#39;, &#39;label5&#39;]].</span>
</span><span id="LCCML-162"><a href="#LCCML-162"><span class="linenos">162</span></a>
</span><span id="LCCML-163"><a href="#LCCML-163"><span class="linenos">163</span></a><span class="sd">        Returns</span>
</span><span id="LCCML-164"><a href="#LCCML-164"><span class="linenos">164</span></a><span class="sd">        -------</span>
</span><span id="LCCML-165"><a href="#LCCML-165"><span class="linenos">165</span></a><span class="sd">        None</span>
</span><span id="LCCML-166"><a href="#LCCML-166"><span class="linenos">166</span></a>
</span><span id="LCCML-167"><a href="#LCCML-167"><span class="linenos">167</span></a><span class="sd">        Example</span>
</span><span id="LCCML-168"><a href="#LCCML-168"><span class="linenos">168</span></a><span class="sd">        -------</span>
</span><span id="LCCML-169"><a href="#LCCML-169"><span class="linenos">169</span></a><span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestClassifier</span>
</span><span id="LCCML-170"><a href="#LCCML-170"><span class="linenos">170</span></a><span class="sd">        &gt;&gt;&gt; model = RandomForestClassifier()</span>
</span><span id="LCCML-171"><a href="#LCCML-171"><span class="linenos">171</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=model, n_chains=5)</span>
</span><span id="LCCML-172"><a href="#LCCML-172"><span class="linenos">172</span></a>
</span><span id="LCCML-173"><a href="#LCCML-173"><span class="linenos">173</span></a><span class="sd">        &gt;&gt;&gt; # Suppose X_train is a pandas DataFrame of features, and Y_train is a pandas DataFrame of labels</span>
</span><span id="LCCML-174"><a href="#LCCML-174"><span class="linenos">174</span></a><span class="sd">        &gt;&gt;&gt; clusters = [[&#39;label_a&#39;, &#39;label_b&#39;], [&#39;label_c&#39;], [&#39;label_d&#39;, &#39;label_e&#39;]]</span>
</span><span id="LCCML-175"><a href="#LCCML-175"><span class="linenos">175</span></a><span class="sd">        &gt;&gt;&gt; lccml.fit(X_train, Y_train, clusters)</span>
</span><span id="LCCML-176"><a href="#LCCML-176"><span class="linenos">176</span></a>
</span><span id="LCCML-177"><a href="#LCCML-177"><span class="linenos">177</span></a><span class="sd">        After fitting, you can access:</span>
</span><span id="LCCML-178"><a href="#LCCML-178"><span class="linenos">178</span></a><span class="sd">        &gt;&gt;&gt; lccml.train_time_total  # total training time</span>
</span><span id="LCCML-179"><a href="#LCCML-179"><span class="linenos">179</span></a><span class="sd">        &gt;&gt;&gt; lccml.chain_train_times # list of training times per chain</span>
</span><span id="LCCML-180"><a href="#LCCML-180"><span class="linenos">180</span></a><span class="sd">        &gt;&gt;&gt; lccml.total_model_size  # total model size (bytes)</span>
</span><span id="LCCML-181"><a href="#LCCML-181"><span class="linenos">181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCCML-182"><a href="#LCCML-182"><span class="linenos">182</span></a>        
</span><span id="LCCML-183"><a href="#LCCML-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__generateOrders</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">))</span>
</span><span id="LCCML-184"><a href="#LCCML-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__preprocessClustersName</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>        
</span><span id="LCCML-185"><a href="#LCCML-185"><span class="linenos">185</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span><span class="p">):</span>
</span><span id="LCCML-186"><a href="#LCCML-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__fitChain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orders</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="LCCML-187"><a href="#LCCML-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_time_total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_train_times</span><span class="p">)</span>
</span><span id="LCCML-188"><a href="#LCCML-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_model_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_model_sizes</span><span class="p">)</span>
</span><span id="LCCML-189"><a href="#LCCML-189"><span class="linenos">189</span></a>    
</span><span id="LCCML-190"><a href="#LCCML-190"><span class="linenos">190</span></a>    
</span><span id="LCCML-191"><a href="#LCCML-191"><span class="linenos">191</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-192"><a href="#LCCML-192"><span class="linenos">192</span></a>    <span class="c1">#                                                 #</span>
</span><span id="LCCML-193"><a href="#LCCML-193"><span class="linenos">193</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-194"><a href="#LCCML-194"><span class="linenos">194</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__generateOrders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_clusters</span><span class="p">):</span>
</span><span id="LCCML-195"><a href="#LCCML-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCCML-196"><a href="#LCCML-196"><span class="linenos">196</span></a><span class="sd">        Generate random permutations of cluster orders for each chain.</span>
</span><span id="LCCML-197"><a href="#LCCML-197"><span class="linenos">197</span></a>
</span><span id="LCCML-198"><a href="#LCCML-198"><span class="linenos">198</span></a><span class="sd">        Each chain will follow a different random order of clusters, ensuring</span>
</span><span id="LCCML-199"><a href="#LCCML-199"><span class="linenos">199</span></a><span class="sd">        diversity across the ensemble of label clusters chains. The generated orders</span>
</span><span id="LCCML-200"><a href="#LCCML-200"><span class="linenos">200</span></a><span class="sd">        are stored in self.orders as a list of numpy arrays.</span>
</span><span id="LCCML-201"><a href="#LCCML-201"><span class="linenos">201</span></a>
</span><span id="LCCML-202"><a href="#LCCML-202"><span class="linenos">202</span></a><span class="sd">        Parameters</span>
</span><span id="LCCML-203"><a href="#LCCML-203"><span class="linenos">203</span></a><span class="sd">        ----------</span>
</span><span id="LCCML-204"><a href="#LCCML-204"><span class="linenos">204</span></a><span class="sd">        n_clusters : int</span>
</span><span id="LCCML-205"><a href="#LCCML-205"><span class="linenos">205</span></a><span class="sd">            Total number of clusters.</span>
</span><span id="LCCML-206"><a href="#LCCML-206"><span class="linenos">206</span></a>
</span><span id="LCCML-207"><a href="#LCCML-207"><span class="linenos">207</span></a><span class="sd">        Returns</span>
</span><span id="LCCML-208"><a href="#LCCML-208"><span class="linenos">208</span></a><span class="sd">        -------</span>
</span><span id="LCCML-209"><a href="#LCCML-209"><span class="linenos">209</span></a><span class="sd">        None</span>
</span><span id="LCCML-210"><a href="#LCCML-210"><span class="linenos">210</span></a>
</span><span id="LCCML-211"><a href="#LCCML-211"><span class="linenos">211</span></a><span class="sd">        Example</span>
</span><span id="LCCML-212"><a href="#LCCML-212"><span class="linenos">212</span></a><span class="sd">        -------</span>
</span><span id="LCCML-213"><a href="#LCCML-213"><span class="linenos">213</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=RandomForestClassifier(), n_chains=3)</span>
</span><span id="LCCML-214"><a href="#LCCML-214"><span class="linenos">214</span></a><span class="sd">        &gt;&gt;&gt; lccml.__generateOrders(n_clusters=4)</span>
</span><span id="LCCML-215"><a href="#LCCML-215"><span class="linenos">215</span></a><span class="sd">        &gt;&gt;&gt; print(lccml.orders)</span>
</span><span id="LCCML-216"><a href="#LCCML-216"><span class="linenos">216</span></a><span class="sd">        [array([2, 1, 3, 0]), array([0, 2, 1, 3]), array([3, 0, 1, 2])]</span>
</span><span id="LCCML-217"><a href="#LCCML-217"><span class="linenos">217</span></a>
</span><span id="LCCML-218"><a href="#LCCML-218"><span class="linenos">218</span></a><span class="sd">        Each array represents one chain&#39;s cluster processing order.</span>
</span><span id="LCCML-219"><a href="#LCCML-219"><span class="linenos">219</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCCML-220"><a href="#LCCML-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">orders</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">n_clusters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span><span class="p">)]</span>
</span><span id="LCCML-221"><a href="#LCCML-221"><span class="linenos">221</span></a>
</span><span id="LCCML-222"><a href="#LCCML-222"><span class="linenos">222</span></a>    
</span><span id="LCCML-223"><a href="#LCCML-223"><span class="linenos">223</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-224"><a href="#LCCML-224"><span class="linenos">224</span></a>    <span class="c1">#                                                 #</span>
</span><span id="LCCML-225"><a href="#LCCML-225"><span class="linenos">225</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-226"><a href="#LCCML-226"><span class="linenos">226</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__fitChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="LCCML-227"><a href="#LCCML-227"><span class="linenos">227</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCCML-228"><a href="#LCCML-228"><span class="linenos">228</span></a><span class="sd">        Train a single label cluster chain following the specified cluster order.</span>
</span><span id="LCCML-229"><a href="#LCCML-229"><span class="linenos">229</span></a>
</span><span id="LCCML-230"><a href="#LCCML-230"><span class="linenos">230</span></a><span class="sd">        For each cluster in the given order, the corresponding labels are trained </span>
</span><span id="LCCML-231"><a href="#LCCML-231"><span class="linenos">231</span></a><span class="sd">        using the base model. After training on a cluster, its predicted labels are </span>
</span><span id="LCCML-232"><a href="#LCCML-232"><span class="linenos">232</span></a><span class="sd">        appended as additional features for training the next cluster.</span>
</span><span id="LCCML-233"><a href="#LCCML-233"><span class="linenos">233</span></a>
</span><span id="LCCML-234"><a href="#LCCML-234"><span class="linenos">234</span></a><span class="sd">        The training time and model size of the chain are recorded.</span>
</span><span id="LCCML-235"><a href="#LCCML-235"><span class="linenos">235</span></a>
</span><span id="LCCML-236"><a href="#LCCML-236"><span class="linenos">236</span></a><span class="sd">        Parameters</span>
</span><span id="LCCML-237"><a href="#LCCML-237"><span class="linenos">237</span></a><span class="sd">        ----------</span>
</span><span id="LCCML-238"><a href="#LCCML-238"><span class="linenos">238</span></a><span class="sd">        order : array-like of int</span>
</span><span id="LCCML-239"><a href="#LCCML-239"><span class="linenos">239</span></a><span class="sd">            A permutation of cluster indices indicating the processing order for this chain.</span>
</span><span id="LCCML-240"><a href="#LCCML-240"><span class="linenos">240</span></a><span class="sd">        </span>
</span><span id="LCCML-241"><a href="#LCCML-241"><span class="linenos">241</span></a><span class="sd">        x : pd.DataFrame</span>
</span><span id="LCCML-242"><a href="#LCCML-242"><span class="linenos">242</span></a><span class="sd">            Feature matrix of shape (n_samples, n_features).</span>
</span><span id="LCCML-243"><a href="#LCCML-243"><span class="linenos">243</span></a><span class="sd">        </span>
</span><span id="LCCML-244"><a href="#LCCML-244"><span class="linenos">244</span></a><span class="sd">        y : pd.DataFrame</span>
</span><span id="LCCML-245"><a href="#LCCML-245"><span class="linenos">245</span></a><span class="sd">            Multi-label target matrix of shape (n_samples, n_labels).</span>
</span><span id="LCCML-246"><a href="#LCCML-246"><span class="linenos">246</span></a>
</span><span id="LCCML-247"><a href="#LCCML-247"><span class="linenos">247</span></a><span class="sd">        Returns</span>
</span><span id="LCCML-248"><a href="#LCCML-248"><span class="linenos">248</span></a><span class="sd">        -------</span>
</span><span id="LCCML-249"><a href="#LCCML-249"><span class="linenos">249</span></a><span class="sd">        None</span>
</span><span id="LCCML-250"><a href="#LCCML-250"><span class="linenos">250</span></a>
</span><span id="LCCML-251"><a href="#LCCML-251"><span class="linenos">251</span></a><span class="sd">        Example</span>
</span><span id="LCCML-252"><a href="#LCCML-252"><span class="linenos">252</span></a><span class="sd">        -------</span>
</span><span id="LCCML-253"><a href="#LCCML-253"><span class="linenos">253</span></a><span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestClassifier</span>
</span><span id="LCCML-254"><a href="#LCCML-254"><span class="linenos">254</span></a><span class="sd">        &gt;&gt;&gt; model = RandomForestClassifier()</span>
</span><span id="LCCML-255"><a href="#LCCML-255"><span class="linenos">255</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=model, n_chains=1)</span>
</span><span id="LCCML-256"><a href="#LCCML-256"><span class="linenos">256</span></a><span class="sd">        &gt;&gt;&gt; clusters = [[&#39;label_a&#39;, &#39;label_b&#39;], [&#39;label_c&#39;], [&#39;label_d&#39;, &#39;label_e&#39;]]</span>
</span><span id="LCCML-257"><a href="#LCCML-257"><span class="linenos">257</span></a><span class="sd">        &gt;&gt;&gt; lccml.fit(X_train, Y_train, clusters)</span>
</span><span id="LCCML-258"><a href="#LCCML-258"><span class="linenos">258</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="LCCML-259"><a href="#LCCML-259"><span class="linenos">259</span></a><span class="sd">        &gt;&gt;&gt; # Suppose we manually want to train one chain:</span>
</span><span id="LCCML-260"><a href="#LCCML-260"><span class="linenos">260</span></a><span class="sd">        &gt;&gt;&gt; order = lccml.orders[0]  # e.g., array([2, 0, 1])</span>
</span><span id="LCCML-261"><a href="#LCCML-261"><span class="linenos">261</span></a><span class="sd">        &gt;&gt;&gt; lccml.__fitChain(order, X_train, Y_train)</span>
</span><span id="LCCML-262"><a href="#LCCML-262"><span class="linenos">262</span></a>
</span><span id="LCCML-263"><a href="#LCCML-263"><span class="linenos">263</span></a><span class="sd">        After execution:</span>
</span><span id="LCCML-264"><a href="#LCCML-264"><span class="linenos">264</span></a><span class="sd">        &gt;&gt;&gt; lccml.chains[-1]  # last trained chain (list of trained models)</span>
</span><span id="LCCML-265"><a href="#LCCML-265"><span class="linenos">265</span></a><span class="sd">        &gt;&gt;&gt; lccml.chain_train_times[-1]  # training time of this chain</span>
</span><span id="LCCML-266"><a href="#LCCML-266"><span class="linenos">266</span></a><span class="sd">        &gt;&gt;&gt; lccml.chain_model_sizes[-1]  # model size (bytes) of this chain</span>
</span><span id="LCCML-267"><a href="#LCCML-267"><span class="linenos">267</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCCML-268"><a href="#LCCML-268"><span class="linenos">268</span></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="LCCML-269"><a href="#LCCML-269"><span class="linenos">269</span></a>
</span><span id="LCCML-270"><a href="#LCCML-270"><span class="linenos">270</span></a>        <span class="n">chain_X</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LCCML-271"><a href="#LCCML-271"><span class="linenos">271</span></a>        <span class="n">chain</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCCML-272"><a href="#LCCML-272"><span class="linenos">272</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">orderLabelsDataset</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">columns</span>
</span><span id="LCCML-273"><a href="#LCCML-273"><span class="linenos">273</span></a>
</span><span id="LCCML-274"><a href="#LCCML-274"><span class="linenos">274</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
</span><span id="LCCML-275"><a href="#LCCML-275"><span class="linenos">275</span></a>            <span class="n">cluster_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="LCCML-276"><a href="#LCCML-276"><span class="linenos">276</span></a>            <span class="n">chainModel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getModel</span><span class="p">()</span>
</span><span id="LCCML-277"><a href="#LCCML-277"><span class="linenos">277</span></a>
</span><span id="LCCML-278"><a href="#LCCML-278"><span class="linenos">278</span></a>            <span class="n">chain_Y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">cluster_labels</span><span class="p">]])</span>
</span><span id="LCCML-279"><a href="#LCCML-279"><span class="linenos">279</span></a>            <span class="n">chainModel</span><span class="o">.</span><span class="n">labelName_</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">cluster_labels</span><span class="p">]</span>
</span><span id="LCCML-280"><a href="#LCCML-280"><span class="linenos">280</span></a>
</span><span id="LCCML-281"><a href="#LCCML-281"><span class="linenos">281</span></a>            <span class="k">if</span> <span class="n">chain_Y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="LCCML-282"><a href="#LCCML-282"><span class="linenos">282</span></a>                <span class="n">chainModel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">chain_X</span><span class="p">,</span> <span class="n">chain_Y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
</span><span id="LCCML-283"><a href="#LCCML-283"><span class="linenos">283</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="LCCML-284"><a href="#LCCML-284"><span class="linenos">284</span></a>                <span class="n">chainModel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">chain_X</span><span class="p">,</span> <span class="n">chain_Y</span><span class="p">)</span>
</span><span id="LCCML-285"><a href="#LCCML-285"><span class="linenos">285</span></a>
</span><span id="LCCML-286"><a href="#LCCML-286"><span class="linenos">286</span></a>            <span class="n">chain_X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">chain_X</span><span class="p">,</span> <span class="n">chain_Y</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="LCCML-287"><a href="#LCCML-287"><span class="linenos">287</span></a>            <span class="n">chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chainModel</span><span class="p">)</span>
</span><span id="LCCML-288"><a href="#LCCML-288"><span class="linenos">288</span></a>
</span><span id="LCCML-289"><a href="#LCCML-289"><span class="linenos">289</span></a>        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="LCCML-290"><a href="#LCCML-290"><span class="linenos">290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chain_train_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
</span><span id="LCCML-291"><a href="#LCCML-291"><span class="linenos">291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
</span><span id="LCCML-292"><a href="#LCCML-292"><span class="linenos">292</span></a>
</span><span id="LCCML-293"><a href="#LCCML-293"><span class="linenos">293</span></a>        <span class="n">model_bytes</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
</span><span id="LCCML-294"><a href="#LCCML-294"><span class="linenos">294</span></a>        <span class="n">model_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_bytes</span><span class="p">)</span>
</span><span id="LCCML-295"><a href="#LCCML-295"><span class="linenos">295</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chain_model_sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_size</span><span class="p">)</span>
</span><span id="LCCML-296"><a href="#LCCML-296"><span class="linenos">296</span></a>        
</span><span id="LCCML-297"><a href="#LCCML-297"><span class="linenos">297</span></a>
</span><span id="LCCML-298"><a href="#LCCML-298"><span class="linenos">298</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-299"><a href="#LCCML-299"><span class="linenos">299</span></a>    <span class="c1">#                                                 #</span>
</span><span id="LCCML-300"><a href="#LCCML-300"><span class="linenos">300</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-301"><a href="#LCCML-301"><span class="linenos">301</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__predictChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">chainIndex</span><span class="p">):</span>
</span><span id="LCCML-302"><a href="#LCCML-302"><span class="linenos">302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCCML-303"><a href="#LCCML-303"><span class="linenos">303</span></a><span class="sd">        Predict using a single label cluster chain of the ensemble.</span>
</span><span id="LCCML-304"><a href="#LCCML-304"><span class="linenos">304</span></a>
</span><span id="LCCML-305"><a href="#LCCML-305"><span class="linenos">305</span></a><span class="sd">        For the specified chain, the model sequentially predicts the probabilistic outputs</span>
</span><span id="LCCML-306"><a href="#LCCML-306"><span class="linenos">306</span></a><span class="sd">        of each cluster, using the predictions of previous clusters as additional features </span>
</span><span id="LCCML-307"><a href="#LCCML-307"><span class="linenos">307</span></a><span class="sd">        for subsequent clusters.</span>
</span><span id="LCCML-308"><a href="#LCCML-308"><span class="linenos">308</span></a>
</span><span id="LCCML-309"><a href="#LCCML-309"><span class="linenos">309</span></a><span class="sd">        Parameters</span>
</span><span id="LCCML-310"><a href="#LCCML-310"><span class="linenos">310</span></a><span class="sd">        ----------</span>
</span><span id="LCCML-311"><a href="#LCCML-311"><span class="linenos">311</span></a><span class="sd">        x : pd.DataFrame</span>
</span><span id="LCCML-312"><a href="#LCCML-312"><span class="linenos">312</span></a><span class="sd">            Feature matrix of shape (n_samples, n_features).</span>
</span><span id="LCCML-313"><a href="#LCCML-313"><span class="linenos">313</span></a><span class="sd">        </span>
</span><span id="LCCML-314"><a href="#LCCML-314"><span class="linenos">314</span></a><span class="sd">        chainIndex : int</span>
</span><span id="LCCML-315"><a href="#LCCML-315"><span class="linenos">315</span></a><span class="sd">            Index of the chain to use for prediction (from 0 to n_chains - 1).</span>
</span><span id="LCCML-316"><a href="#LCCML-316"><span class="linenos">316</span></a>
</span><span id="LCCML-317"><a href="#LCCML-317"><span class="linenos">317</span></a><span class="sd">        Returns</span>
</span><span id="LCCML-318"><a href="#LCCML-318"><span class="linenos">318</span></a><span class="sd">        -------</span>
</span><span id="LCCML-319"><a href="#LCCML-319"><span class="linenos">319</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="LCCML-320"><a href="#LCCML-320"><span class="linenos">320</span></a><span class="sd">            Predicted probabilities for all labels from this chain.</span>
</span><span id="LCCML-321"><a href="#LCCML-321"><span class="linenos">321</span></a><span class="sd">            The columns are aligned to the original label set used during training.</span>
</span><span id="LCCML-322"><a href="#LCCML-322"><span class="linenos">322</span></a>
</span><span id="LCCML-323"><a href="#LCCML-323"><span class="linenos">323</span></a><span class="sd">        Example</span>
</span><span id="LCCML-324"><a href="#LCCML-324"><span class="linenos">324</span></a><span class="sd">        -------</span>
</span><span id="LCCML-325"><a href="#LCCML-325"><span class="linenos">325</span></a><span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestClassifier</span>
</span><span id="LCCML-326"><a href="#LCCML-326"><span class="linenos">326</span></a><span class="sd">        &gt;&gt;&gt; model = RandomForestClassifier()</span>
</span><span id="LCCML-327"><a href="#LCCML-327"><span class="linenos">327</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=model, n_chains=3)</span>
</span><span id="LCCML-328"><a href="#LCCML-328"><span class="linenos">328</span></a><span class="sd">        &gt;&gt;&gt; clusters = [[&#39;label_a&#39;, &#39;label_b&#39;], [&#39;label_c&#39;], [&#39;label_d&#39;]]</span>
</span><span id="LCCML-329"><a href="#LCCML-329"><span class="linenos">329</span></a><span class="sd">        &gt;&gt;&gt; lccml.fit(X_train, Y_train, clusters)</span>
</span><span id="LCCML-330"><a href="#LCCML-330"><span class="linenos">330</span></a>
</span><span id="LCCML-331"><a href="#LCCML-331"><span class="linenos">331</span></a><span class="sd">        &gt;&gt;&gt; # Predict using only chain 0</span>
</span><span id="LCCML-332"><a href="#LCCML-332"><span class="linenos">332</span></a><span class="sd">        &gt;&gt;&gt; pred_chain_0 = lccml.__predictChain(X_test, chainIndex=0)</span>
</span><span id="LCCML-333"><a href="#LCCML-333"><span class="linenos">333</span></a><span class="sd">        &gt;&gt;&gt; print(pred_chain_0.shape)  # (n_samples, n_labels)</span>
</span><span id="LCCML-334"><a href="#LCCML-334"><span class="linenos">334</span></a>
</span><span id="LCCML-335"><a href="#LCCML-335"><span class="linenos">335</span></a><span class="sd">        Notes</span>
</span><span id="LCCML-336"><a href="#LCCML-336"><span class="linenos">336</span></a><span class="sd">        -----</span>
</span><span id="LCCML-337"><a href="#LCCML-337"><span class="linenos">337</span></a><span class="sd">        - The method outputs probabilities, not binary predictions.</span>
</span><span id="LCCML-338"><a href="#LCCML-338"><span class="linenos">338</span></a><span class="sd">        - Used internally by `predict()`, which averages predictions across chains.</span>
</span><span id="LCCML-339"><a href="#LCCML-339"><span class="linenos">339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCCML-340"><a href="#LCCML-340"><span class="linenos">340</span></a>        <span class="n">chain_X</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LCCML-341"><a href="#LCCML-341"><span class="linenos">341</span></a>        <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
</span><span id="LCCML-342"><a href="#LCCML-342"><span class="linenos">342</span></a>
</span><span id="LCCML-343"><a href="#LCCML-343"><span class="linenos">343</span></a>        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">chainIndex</span><span class="p">]:</span>
</span><span id="LCCML-344"><a href="#LCCML-344"><span class="linenos">344</span></a>            <span class="n">pred_proba</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">chain_X</span><span class="p">)</span>
</span><span id="LCCML-345"><a href="#LCCML-345"><span class="linenos">345</span></a>
</span><span id="LCCML-346"><a href="#LCCML-346"><span class="linenos">346</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pred_proba</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="LCCML-347"><a href="#LCCML-347"><span class="linenos">347</span></a>                <span class="n">pred_proba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="LCCML-348"><a href="#LCCML-348"><span class="linenos">348</span></a>                    <span class="p">[</span><span class="n">probs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">probs</span> <span class="ow">in</span> <span class="n">pred_proba</span><span class="p">],</span>
</span><span id="LCCML-349"><a href="#LCCML-349"><span class="linenos">349</span></a>                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
</span><span id="LCCML-350"><a href="#LCCML-350"><span class="linenos">350</span></a>                <span class="p">)</span>
</span><span id="LCCML-351"><a href="#LCCML-351"><span class="linenos">351</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="LCCML-352"><a href="#LCCML-352"><span class="linenos">352</span></a>                <span class="n">pred_proba</span> <span class="o">=</span> <span class="n">pred_proba</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="LCCML-353"><a href="#LCCML-353"><span class="linenos">353</span></a>
</span><span id="LCCML-354"><a href="#LCCML-354"><span class="linenos">354</span></a>            <span class="n">pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred_proba</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">labelName_</span><span class="p">)</span>
</span><span id="LCCML-355"><a href="#LCCML-355"><span class="linenos">355</span></a>            <span class="n">predictions</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">labelName_</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_df</span>
</span><span id="LCCML-356"><a href="#LCCML-356"><span class="linenos">356</span></a>
</span><span id="LCCML-357"><a href="#LCCML-357"><span class="linenos">357</span></a>            <span class="c1"># Atualiza as features com as predições do cluster atual</span>
</span><span id="LCCML-358"><a href="#LCCML-358"><span class="linenos">358</span></a>            <span class="n">chain_X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">chain_X</span><span class="p">,</span> <span class="n">pred_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="LCCML-359"><a href="#LCCML-359"><span class="linenos">359</span></a>
</span><span id="LCCML-360"><a href="#LCCML-360"><span class="linenos">360</span></a>        <span class="c1"># Ordena as colunas de acordo com as labels originais</span>
</span><span id="LCCML-361"><a href="#LCCML-361"><span class="linenos">361</span></a>        <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">orderLabelsDataset</span><span class="p">]</span>
</span><span id="LCCML-362"><a href="#LCCML-362"><span class="linenos">362</span></a>        <span class="k">return</span> <span class="n">predictions</span>    
</span><span id="LCCML-363"><a href="#LCCML-363"><span class="linenos">363</span></a>          
</span><span id="LCCML-364"><a href="#LCCML-364"><span class="linenos">364</span></a>
</span><span id="LCCML-365"><a href="#LCCML-365"><span class="linenos">365</span></a>
</span><span id="LCCML-366"><a href="#LCCML-366"><span class="linenos">366</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-367"><a href="#LCCML-367"><span class="linenos">367</span></a>    <span class="c1">#                                                 #</span>
</span><span id="LCCML-368"><a href="#LCCML-368"><span class="linenos">368</span></a>    <span class="c1"># ----------------------------------------------- # </span>
</span><span id="LCCML-369"><a href="#LCCML-369"><span class="linenos">369</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__getModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LCCML-370"><a href="#LCCML-370"><span class="linenos">370</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCCML-371"><a href="#LCCML-371"><span class="linenos">371</span></a><span class="sd">        Clone the base classifier.</span>
</span><span id="LCCML-372"><a href="#LCCML-372"><span class="linenos">372</span></a>
</span><span id="LCCML-373"><a href="#LCCML-373"><span class="linenos">373</span></a><span class="sd">        This method creates a new independent instance of the base model provided</span>
</span><span id="LCCML-374"><a href="#LCCML-374"><span class="linenos">374</span></a><span class="sd">        during the initialization of the LCCML object. It ensures that each model </span>
</span><span id="LCCML-375"><a href="#LCCML-375"><span class="linenos">375</span></a><span class="sd">        in the chain is trained independently and avoids parameter sharing </span>
</span><span id="LCCML-376"><a href="#LCCML-376"><span class="linenos">376</span></a><span class="sd">        between chains or clusters.</span>
</span><span id="LCCML-377"><a href="#LCCML-377"><span class="linenos">377</span></a>
</span><span id="LCCML-378"><a href="#LCCML-378"><span class="linenos">378</span></a><span class="sd">        Returns</span>
</span><span id="LCCML-379"><a href="#LCCML-379"><span class="linenos">379</span></a><span class="sd">        -------</span>
</span><span id="LCCML-380"><a href="#LCCML-380"><span class="linenos">380</span></a><span class="sd">        sklearn-like estimator</span>
</span><span id="LCCML-381"><a href="#LCCML-381"><span class="linenos">381</span></a><span class="sd">            A fresh copy of the base classifier, ready to be trained.</span>
</span><span id="LCCML-382"><a href="#LCCML-382"><span class="linenos">382</span></a>
</span><span id="LCCML-383"><a href="#LCCML-383"><span class="linenos">383</span></a><span class="sd">        Example</span>
</span><span id="LCCML-384"><a href="#LCCML-384"><span class="linenos">384</span></a><span class="sd">        -------</span>
</span><span id="LCCML-385"><a href="#LCCML-385"><span class="linenos">385</span></a><span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestClassifier</span>
</span><span id="LCCML-386"><a href="#LCCML-386"><span class="linenos">386</span></a><span class="sd">        &gt;&gt;&gt; model = RandomForestClassifier(n_estimators=100)</span>
</span><span id="LCCML-387"><a href="#LCCML-387"><span class="linenos">387</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=model, n_chains=5)</span>
</span><span id="LCCML-388"><a href="#LCCML-388"><span class="linenos">388</span></a><span class="sd">        </span>
</span><span id="LCCML-389"><a href="#LCCML-389"><span class="linenos">389</span></a><span class="sd">        &gt;&gt;&gt; cloned_model = lccml.__getModel()</span>
</span><span id="LCCML-390"><a href="#LCCML-390"><span class="linenos">390</span></a><span class="sd">        &gt;&gt;&gt; cloned_model.fit(X_train, Y_train)</span>
</span><span id="LCCML-391"><a href="#LCCML-391"><span class="linenos">391</span></a><span class="sd">        &gt;&gt;&gt; predictions = cloned_model.predict(X_test)</span>
</span><span id="LCCML-392"><a href="#LCCML-392"><span class="linenos">392</span></a><span class="sd">        </span>
</span><span id="LCCML-393"><a href="#LCCML-393"><span class="linenos">393</span></a><span class="sd">        Notes</span>
</span><span id="LCCML-394"><a href="#LCCML-394"><span class="linenos">394</span></a><span class="sd">        -----</span>
</span><span id="LCCML-395"><a href="#LCCML-395"><span class="linenos">395</span></a><span class="sd">        - Internally uses `sklearn.base.clone` to copy hyperparameters and structure.</span>
</span><span id="LCCML-396"><a href="#LCCML-396"><span class="linenos">396</span></a><span class="sd">        - This method ensures no data leakage or unintended parameter sharing across models.</span>
</span><span id="LCCML-397"><a href="#LCCML-397"><span class="linenos">397</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCCML-398"><a href="#LCCML-398"><span class="linenos">398</span></a>        <span class="k">return</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span><span id="LCCML-399"><a href="#LCCML-399"><span class="linenos">399</span></a>    
</span><span id="LCCML-400"><a href="#LCCML-400"><span class="linenos">400</span></a>
</span><span id="LCCML-401"><a href="#LCCML-401"><span class="linenos">401</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-402"><a href="#LCCML-402"><span class="linenos">402</span></a>    <span class="c1">#                                                 #</span>
</span><span id="LCCML-403"><a href="#LCCML-403"><span class="linenos">403</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-404"><a href="#LCCML-404"><span class="linenos">404</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__preprocessClustersName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
</span><span id="LCCML-405"><a href="#LCCML-405"><span class="linenos">405</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCCML-406"><a href="#LCCML-406"><span class="linenos">406</span></a><span class="sd">        Convert cluster label names to column indices.</span>
</span><span id="LCCML-407"><a href="#LCCML-407"><span class="linenos">407</span></a>
</span><span id="LCCML-408"><a href="#LCCML-408"><span class="linenos">408</span></a><span class="sd">        This function maps each label name inside the provided clusters into the corresponding </span>
</span><span id="LCCML-409"><a href="#LCCML-409"><span class="linenos">409</span></a><span class="sd">        column indices of the label matrix Y. Internally, all clusters are stored as index </span>
</span><span id="LCCML-410"><a href="#LCCML-410"><span class="linenos">410</span></a><span class="sd">        positions for efficient access during training and prediction.</span>
</span><span id="LCCML-411"><a href="#LCCML-411"><span class="linenos">411</span></a>
</span><span id="LCCML-412"><a href="#LCCML-412"><span class="linenos">412</span></a><span class="sd">        Parameters</span>
</span><span id="LCCML-413"><a href="#LCCML-413"><span class="linenos">413</span></a><span class="sd">        ----------</span>
</span><span id="LCCML-414"><a href="#LCCML-414"><span class="linenos">414</span></a><span class="sd">        clusters : list of lists of str</span>
</span><span id="LCCML-415"><a href="#LCCML-415"><span class="linenos">415</span></a><span class="sd">            Each sublist contains label names that belong to a cluster. </span>
</span><span id="LCCML-416"><a href="#LCCML-416"><span class="linenos">416</span></a><span class="sd">            Example: [[&#39;label_a&#39;, &#39;label_b&#39;], [&#39;label_c&#39;], [&#39;label_d&#39;, &#39;label_e&#39;]]</span>
</span><span id="LCCML-417"><a href="#LCCML-417"><span class="linenos">417</span></a><span class="sd">        </span>
</span><span id="LCCML-418"><a href="#LCCML-418"><span class="linenos">418</span></a><span class="sd">        Y : pd.DataFrame</span>
</span><span id="LCCML-419"><a href="#LCCML-419"><span class="linenos">419</span></a><span class="sd">            The multi-label target matrix where columns are label names.</span>
</span><span id="LCCML-420"><a href="#LCCML-420"><span class="linenos">420</span></a>
</span><span id="LCCML-421"><a href="#LCCML-421"><span class="linenos">421</span></a><span class="sd">        Returns</span>
</span><span id="LCCML-422"><a href="#LCCML-422"><span class="linenos">422</span></a><span class="sd">        -------</span>
</span><span id="LCCML-423"><a href="#LCCML-423"><span class="linenos">423</span></a><span class="sd">        list of lists of int</span>
</span><span id="LCCML-424"><a href="#LCCML-424"><span class="linenos">424</span></a><span class="sd">            The clusters with label indices instead of names. Each sublist contains </span>
</span><span id="LCCML-425"><a href="#LCCML-425"><span class="linenos">425</span></a><span class="sd">            the integer indices of the labels in the Y columns.</span>
</span><span id="LCCML-426"><a href="#LCCML-426"><span class="linenos">426</span></a>
</span><span id="LCCML-427"><a href="#LCCML-427"><span class="linenos">427</span></a><span class="sd">        Example</span>
</span><span id="LCCML-428"><a href="#LCCML-428"><span class="linenos">428</span></a><span class="sd">        -------</span>
</span><span id="LCCML-429"><a href="#LCCML-429"><span class="linenos">429</span></a><span class="sd">        &gt;&gt;&gt; Y = pd.DataFrame(columns=[&#39;label_a&#39;, &#39;label_b&#39;, &#39;label_c&#39;, &#39;label_d&#39;])</span>
</span><span id="LCCML-430"><a href="#LCCML-430"><span class="linenos">430</span></a><span class="sd">        &gt;&gt;&gt; clusters = [[&#39;label_a&#39;, &#39;label_b&#39;], [&#39;label_c&#39;], [&#39;label_d&#39;]]</span>
</span><span id="LCCML-431"><a href="#LCCML-431"><span class="linenos">431</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=SomeClassifier())</span>
</span><span id="LCCML-432"><a href="#LCCML-432"><span class="linenos">432</span></a><span class="sd">        &gt;&gt;&gt; cluster_indices = lccml.__preprocessClustersName(clusters, Y)</span>
</span><span id="LCCML-433"><a href="#LCCML-433"><span class="linenos">433</span></a><span class="sd">        &gt;&gt;&gt; print(cluster_indices)</span>
</span><span id="LCCML-434"><a href="#LCCML-434"><span class="linenos">434</span></a><span class="sd">        [[0, 1], [2], [3]]</span>
</span><span id="LCCML-435"><a href="#LCCML-435"><span class="linenos">435</span></a>
</span><span id="LCCML-436"><a href="#LCCML-436"><span class="linenos">436</span></a><span class="sd">        Notes</span>
</span><span id="LCCML-437"><a href="#LCCML-437"><span class="linenos">437</span></a><span class="sd">        -----</span>
</span><span id="LCCML-438"><a href="#LCCML-438"><span class="linenos">438</span></a><span class="sd">        - The column indices are necessary for efficient internal processing.</span>
</span><span id="LCCML-439"><a href="#LCCML-439"><span class="linenos">439</span></a><span class="sd">        - This function assumes that all provided label names exist as columns in Y.</span>
</span><span id="LCCML-440"><a href="#LCCML-440"><span class="linenos">440</span></a><span class="sd">        - Raises `KeyError` if any label name is not found in Y.</span>
</span><span id="LCCML-441"><a href="#LCCML-441"><span class="linenos">441</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCCML-442"><a href="#LCCML-442"><span class="linenos">442</span></a>        <span class="n">clustersIndexes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LCCML-443"><a href="#LCCML-443"><span class="linenos">443</span></a>            <span class="p">[</span><span class="n">Y</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cluster_labels</span><span class="p">]</span>
</span><span id="LCCML-444"><a href="#LCCML-444"><span class="linenos">444</span></a>            <span class="k">for</span> <span class="n">cluster_labels</span> <span class="ow">in</span> <span class="n">clusters</span>
</span><span id="LCCML-445"><a href="#LCCML-445"><span class="linenos">445</span></a>        <span class="p">]</span>
</span><span id="LCCML-446"><a href="#LCCML-446"><span class="linenos">446</span></a>        <span class="k">return</span> <span class="n">clustersIndexes</span>
</span><span id="LCCML-447"><a href="#LCCML-447"><span class="linenos">447</span></a>    
</span><span id="LCCML-448"><a href="#LCCML-448"><span class="linenos">448</span></a>
</span><span id="LCCML-449"><a href="#LCCML-449"><span class="linenos">449</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-450"><a href="#LCCML-450"><span class="linenos">450</span></a>    <span class="c1">#                                                 #</span>
</span><span id="LCCML-451"><a href="#LCCML-451"><span class="linenos">451</span></a>    <span class="c1"># ----------------------------------------------- #</span>
</span><span id="LCCML-452"><a href="#LCCML-452"><span class="linenos">452</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="LCCML-453"><a href="#LCCML-453"><span class="linenos">453</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCCML-454"><a href="#LCCML-454"><span class="linenos">454</span></a><span class="sd">        Performs model prediction by aggregating the results from multiple chains.</span>
</span><span id="LCCML-455"><a href="#LCCML-455"><span class="linenos">455</span></a>
</span><span id="LCCML-456"><a href="#LCCML-456"><span class="linenos">456</span></a><span class="sd">        For each chain, the model sequentially predicts the clusters according to its specific order.</span>
</span><span id="LCCML-457"><a href="#LCCML-457"><span class="linenos">457</span></a><span class="sd">        The individual predictions from all chains are aggregated by averaging the predictions </span>
</span><span id="LCCML-458"><a href="#LCCML-458"><span class="linenos">458</span></a><span class="sd">        across chains for each label. This produces probabilistic predictions for each label.</span>
</span><span id="LCCML-459"><a href="#LCCML-459"><span class="linenos">459</span></a>
</span><span id="LCCML-460"><a href="#LCCML-460"><span class="linenos">460</span></a><span class="sd">        Parameters</span>
</span><span id="LCCML-461"><a href="#LCCML-461"><span class="linenos">461</span></a><span class="sd">        ----------</span>
</span><span id="LCCML-462"><a href="#LCCML-462"><span class="linenos">462</span></a><span class="sd">        x : pd.DataFrame</span>
</span><span id="LCCML-463"><a href="#LCCML-463"><span class="linenos">463</span></a><span class="sd">            DataFrame containing the input data (features) for prediction.</span>
</span><span id="LCCML-464"><a href="#LCCML-464"><span class="linenos">464</span></a><span class="sd">            Shape: (n_samples, n_features)</span>
</span><span id="LCCML-465"><a href="#LCCML-465"><span class="linenos">465</span></a>
</span><span id="LCCML-466"><a href="#LCCML-466"><span class="linenos">466</span></a><span class="sd">        Returns</span>
</span><span id="LCCML-467"><a href="#LCCML-467"><span class="linenos">467</span></a><span class="sd">        -------</span>
</span><span id="LCCML-468"><a href="#LCCML-468"><span class="linenos">468</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="LCCML-469"><a href="#LCCML-469"><span class="linenos">469</span></a><span class="sd">            DataFrame containing the aggregated predicted probabilities for each label.</span>
</span><span id="LCCML-470"><a href="#LCCML-470"><span class="linenos">470</span></a><span class="sd">            Shape: (n_samples, n_labels)</span>
</span><span id="LCCML-471"><a href="#LCCML-471"><span class="linenos">471</span></a><span class="sd">            The columns match the label names used during training.</span>
</span><span id="LCCML-472"><a href="#LCCML-472"><span class="linenos">472</span></a>
</span><span id="LCCML-473"><a href="#LCCML-473"><span class="linenos">473</span></a><span class="sd">        Example</span>
</span><span id="LCCML-474"><a href="#LCCML-474"><span class="linenos">474</span></a><span class="sd">        -------</span>
</span><span id="LCCML-475"><a href="#LCCML-475"><span class="linenos">475</span></a><span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestClassifier</span>
</span><span id="LCCML-476"><a href="#LCCML-476"><span class="linenos">476</span></a><span class="sd">        &gt;&gt;&gt; model = RandomForestClassifier()</span>
</span><span id="LCCML-477"><a href="#LCCML-477"><span class="linenos">477</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=model, n_chains=5)</span>
</span><span id="LCCML-478"><a href="#LCCML-478"><span class="linenos">478</span></a><span class="sd">        &gt;&gt;&gt; clusters = [[&#39;label_a&#39;, &#39;label_b&#39;], [&#39;label_c&#39;], [&#39;label_d&#39;, &#39;label_e&#39;]]</span>
</span><span id="LCCML-479"><a href="#LCCML-479"><span class="linenos">479</span></a><span class="sd">        &gt;&gt;&gt; lccml.fit(X_train, Y_train, clusters)</span>
</span><span id="LCCML-480"><a href="#LCCML-480"><span class="linenos">480</span></a><span class="sd">        &gt;&gt;&gt; Y_pred = lccml.predict(X_test)</span>
</span><span id="LCCML-481"><a href="#LCCML-481"><span class="linenos">481</span></a><span class="sd">        &gt;&gt;&gt; print(Y_pred.head())</span>
</span><span id="LCCML-482"><a href="#LCCML-482"><span class="linenos">482</span></a><span class="sd">        amazed.suprised  happy.pleased  relaxing.calm  quiet.still  ... angry.aggresive</span>
</span><span id="LCCML-483"><a href="#LCCML-483"><span class="linenos">483</span></a>
</span><span id="LCCML-484"><a href="#LCCML-484"><span class="linenos">484</span></a><span class="sd">        Notes</span>
</span><span id="LCCML-485"><a href="#LCCML-485"><span class="linenos">485</span></a><span class="sd">        -----</span>
</span><span id="LCCML-486"><a href="#LCCML-486"><span class="linenos">486</span></a><span class="sd">        - The aggregation is performed by computing the mean across predictions from all chains.</span>
</span><span id="LCCML-487"><a href="#LCCML-487"><span class="linenos">487</span></a><span class="sd">        - In case of any error during prediction, an exception will be printed.</span>
</span><span id="LCCML-488"><a href="#LCCML-488"><span class="linenos">488</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCCML-489"><a href="#LCCML-489"><span class="linenos">489</span></a>        <span class="c1"># Performs predictions for each of the chains, using __predictChain for each chain index (0 to n_chains-1)</span>
</span><span id="LCCML-490"><a href="#LCCML-490"><span class="linenos">490</span></a>        <span class="c1"># The result of each chain is concatenated along axis 0 (stacked vertically).</span>
</span><span id="LCCML-491"><a href="#LCCML-491"><span class="linenos">491</span></a>        <span class="c1"># predictions = pd.concat([self.__predictChain(x, i) for i in range(self.n_chains)], axis=0)        </span>
</span><span id="LCCML-492"><a href="#LCCML-492"><span class="linenos">492</span></a>        
</span><span id="LCCML-493"><a href="#LCCML-493"><span class="linenos">493</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LCCML-494"><a href="#LCCML-494"><span class="linenos">494</span></a>            <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">__predictChain</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="LCCML-495"><a href="#LCCML-495"><span class="linenos">495</span></a>            <span class="c1"># print(&quot;PREDICTIONS INSIDE PREDICT 2 before applying the mean&quot;)</span>
</span><span id="LCCML-496"><a href="#LCCML-496"><span class="linenos">496</span></a>            <span class="c1"># print(predictions)</span>
</span><span id="LCCML-497"><a href="#LCCML-497"><span class="linenos">497</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LCCML-498"><a href="#LCCML-498"><span class="linenos">498</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LCCML-499"><a href="#LCCML-499"><span class="linenos">499</span></a>        
</span><span id="LCCML-500"><a href="#LCCML-500"><span class="linenos">500</span></a>        <span class="n">predictions_aggregated</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="LCCML-501"><a href="#LCCML-501"><span class="linenos">501</span></a>        <span class="c1"># print(&quot;AGGREGATED PREDICTIONS:&quot;)</span>
</span><span id="LCCML-502"><a href="#LCCML-502"><span class="linenos">502</span></a>        <span class="c1"># print(predictions_aggregated)</span>
</span><span id="LCCML-503"><a href="#LCCML-503"><span class="linenos">503</span></a>
</span><span id="LCCML-504"><a href="#LCCML-504"><span class="linenos">504</span></a>        <span class="c1"># Now, for each class (column) in the DataFrame, compute the mean of the </span>
</span><span id="LCCML-505"><a href="#LCCML-505"><span class="linenos">505</span></a>        <span class="c1"># predictions for each group of examples (rows)</span>
</span><span id="LCCML-506"><a href="#LCCML-506"><span class="linenos">506</span></a>        <span class="c1"># We group by rows (index), and for each group (class), apply the mean        </span>
</span><span id="LCCML-507"><a href="#LCCML-507"><span class="linenos">507</span></a>        <span class="c1"># return predictions.groupby(predictions.index).apply(np.mean)</span>
</span><span id="LCCML-508"><a href="#LCCML-508"><span class="linenos">508</span></a>        <span class="c1"># predictions.mean(axis=0)  # Computes the mean per label (column)</span>
</span><span id="LCCML-509"><a href="#LCCML-509"><span class="linenos">509</span></a>
</span><span id="LCCML-510"><a href="#LCCML-510"><span class="linenos">510</span></a>        <span class="c1"># Now, for each sample, we select the highest prediction across chains</span>
</span><span id="LCCML-511"><a href="#LCCML-511"><span class="linenos">511</span></a>        <span class="c1"># We group by samples (index), and for each group (class), apply the max</span>
</span><span id="LCCML-512"><a href="#LCCML-512"><span class="linenos">512</span></a>        <span class="c1"># predictions_aggregated = predictions.groupby(predictions.index).max()</span>
</span><span id="LCCML-513"><a href="#LCCML-513"><span class="linenos">513</span></a>
</span><span id="LCCML-514"><a href="#LCCML-514"><span class="linenos">514</span></a>        <span class="k">return</span> <span class="n">predictions_aggregated</span>
</span></pre></div>


            <div class="docstring"><p>Label Clusters Chains for Multi-Label Classification (LCCML).</p>

<p>The algorithm trains an ensemble of classifier chains, where each chain
operates on a random permutation of label clusters. Each cluster can contain 
one or multiple labels. The prediction of previous clusters is added as input 
for subsequent clusters in the chain.</p>

<p>Additional features implemented:</p>

<ul>
<li>Measures training time per chain and total training time.</li>
<li>Measures model size per chain and total model size in memory (without disk I/O).</li>
<li>Measures total prediction time.</li>
</ul>

<h2 id="parameters">Parameters</h2>

<p>model : sklearn-like estimator
    Base classifier to be used for each cluster.</p>

<p>n_chains : int, default=10
    Number of chains in the ensemble.</p>

<h2 id="attributes">Attributes</h2>

<p>orders : list
    Stores the random order of clusters for each chain.</p>

<p>chains : list
    Trained chains (list of models per chain).</p>

<p>chain_train_times : list
    Training time for each chain.</p>

<p>train_time_total : float
    Total training time.</p>

<p>chain_model_sizes : list
    Size (in bytes) of each chain (in memory).</p>

<p>total_model_size : int
    Total size (sum of all chains).</p>

<p>test_time_total : float
    Accumulated total prediction time.</p>

<h2 id="example-of-usage">Example of Usage</h2>

<p>from sklearn.ensemble import RandomForestClassifier</p>

<p>model_base = RandomForestClassifier()</p>

<p>lccml = LCCML(model=model_base, n_chains=10)</p>

<p>clusters = [['label1', 'label2'], ['label3'], ['label4', 'label5']]</p>

<p>lccml.fit(X_train, Y_train, clusters)</p>

<p>Y_pred = lccml.predict(X_test)</p>

<p>print("Total training time:", lccml.train_time_total)</p>

<p>print("Training times per chain:", lccml.chain_train_times)</p>

<p>print("Model sizes (bytes):", lccml.chain_model_sizes)</p>

<p>print("Total model size (bytes):", lccml.total_model_size)</p>

<p>print("Total prediction time:", lccml.test_time_total)</p>
</div>


                            <div id="LCCML.__init__" class="classattr">
                                        <input id="LCCML.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">LCCML</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">model</span>, </span><span class="param"><span class="n">n_chains</span><span class="o">=</span><span class="mi">10</span></span>)</span>

                <label class="view-source-button" for="LCCML.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCCML.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCCML.__init__-128"><a href="#LCCML.__init__-128"><span class="linenos">128</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">n_chains</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>             
</span><span id="LCCML.__init__-129"><a href="#LCCML.__init__-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>          
</span><span id="LCCML.__init__-130"><a href="#LCCML.__init__-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span> <span class="o">=</span> <span class="n">n_chains</span>    
</span><span id="LCCML.__init__-131"><a href="#LCCML.__init__-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">orders</span> <span class="o">=</span> <span class="kc">None</span>         
</span><span id="LCCML.__init__-132"><a href="#LCCML.__init__-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chains</span> <span class="o">=</span> <span class="p">[]</span>           
</span><span id="LCCML.__init__-133"><a href="#LCCML.__init__-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chain_train_times</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCCML.__init__-134"><a href="#LCCML.__init__-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_time_total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LCCML.__init__-135"><a href="#LCCML.__init__-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_time_total</span> <span class="o">=</span> <span class="mi">0</span> 
</span><span id="LCCML.__init__-136"><a href="#LCCML.__init__-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chain_model_sizes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCCML.__init__-137"><a href="#LCCML.__init__-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_model_size</span> <span class="o">=</span> <span class="mi">0</span>
</span></pre></div>


    

                            </div>
                            <div id="LCCML.random_seed" class="classattr">
                                <div class="attr variable">
            <span class="name">random_seed</span>        =
<span class="default_value">1234</span>

        
    </div>
    <a class="headerlink" href="#LCCML.random_seed"></a>
    
    

                            </div>
                            <div id="LCCML.rng" class="classattr">
                                <div class="attr variable">
            <span class="name">rng</span>        =
<span class="default_value">Generator(PCG64) at 0x76B05D5D6A40</span>

        
    </div>
    <a class="headerlink" href="#LCCML.rng"></a>
    
    

                            </div>
                            <div id="LCCML.model" class="classattr">
                                <div class="attr variable">
            <span class="name">model</span>

        
    </div>
    <a class="headerlink" href="#LCCML.model"></a>
    
    

                            </div>
                            <div id="LCCML.n_chains" class="classattr">
                                <div class="attr variable">
            <span class="name">n_chains</span>

        
    </div>
    <a class="headerlink" href="#LCCML.n_chains"></a>
    
    

                            </div>
                            <div id="LCCML.orders" class="classattr">
                                <div class="attr variable">
            <span class="name">orders</span>

        
    </div>
    <a class="headerlink" href="#LCCML.orders"></a>
    
    

                            </div>
                            <div id="LCCML.chains" class="classattr">
                                <div class="attr variable">
            <span class="name">chains</span>

        
    </div>
    <a class="headerlink" href="#LCCML.chains"></a>
    
    

                            </div>
                            <div id="LCCML.chain_train_times" class="classattr">
                                <div class="attr variable">
            <span class="name">chain_train_times</span>

        
    </div>
    <a class="headerlink" href="#LCCML.chain_train_times"></a>
    
    

                            </div>
                            <div id="LCCML.train_time_total" class="classattr">
                                <div class="attr variable">
            <span class="name">train_time_total</span>

        
    </div>
    <a class="headerlink" href="#LCCML.train_time_total"></a>
    
    

                            </div>
                            <div id="LCCML.test_time_total" class="classattr">
                                <div class="attr variable">
            <span class="name">test_time_total</span>

        
    </div>
    <a class="headerlink" href="#LCCML.test_time_total"></a>
    
    

                            </div>
                            <div id="LCCML.chain_model_sizes" class="classattr">
                                <div class="attr variable">
            <span class="name">chain_model_sizes</span>

        
    </div>
    <a class="headerlink" href="#LCCML.chain_model_sizes"></a>
    
    

                            </div>
                            <div id="LCCML.total_model_size" class="classattr">
                                <div class="attr variable">
            <span class="name">total_model_size</span>

        
    </div>
    <a class="headerlink" href="#LCCML.total_model_size"></a>
    
    

                            </div>
                            <div id="LCCML.fit" class="classattr">
                                        <input id="LCCML.fit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fit</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">y</span>, </span><span class="param"><span class="n">clusters</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LCCML.fit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCCML.fit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCCML.fit-143"><a href="#LCCML.fit-143"><span class="linenos">143</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">clusters</span><span class="p">):</span>
</span><span id="LCCML.fit-144"><a href="#LCCML.fit-144"><span class="linenos">144</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCCML.fit-145"><a href="#LCCML.fit-145"><span class="linenos">145</span></a><span class="sd">        Train the ensemble of label clusters chains.</span>
</span><span id="LCCML.fit-146"><a href="#LCCML.fit-146"><span class="linenos">146</span></a>
</span><span id="LCCML.fit-147"><a href="#LCCML.fit-147"><span class="linenos">147</span></a><span class="sd">        This method trains multiple classifier chains. Each chain follows a random </span>
</span><span id="LCCML.fit-148"><a href="#LCCML.fit-148"><span class="linenos">148</span></a><span class="sd">        permutation of the provided label clusters. The model uses the predictions </span>
</span><span id="LCCML.fit-149"><a href="#LCCML.fit-149"><span class="linenos">149</span></a><span class="sd">        of previous clusters as additional features when training subsequent clusters.</span>
</span><span id="LCCML.fit-150"><a href="#LCCML.fit-150"><span class="linenos">150</span></a>
</span><span id="LCCML.fit-151"><a href="#LCCML.fit-151"><span class="linenos">151</span></a><span class="sd">        Parameters</span>
</span><span id="LCCML.fit-152"><a href="#LCCML.fit-152"><span class="linenos">152</span></a><span class="sd">        ----------</span>
</span><span id="LCCML.fit-153"><a href="#LCCML.fit-153"><span class="linenos">153</span></a><span class="sd">        x : pd.DataFrame</span>
</span><span id="LCCML.fit-154"><a href="#LCCML.fit-154"><span class="linenos">154</span></a><span class="sd">            Feature matrix of shape (n_samples, n_features).</span>
</span><span id="LCCML.fit-155"><a href="#LCCML.fit-155"><span class="linenos">155</span></a><span class="sd">        </span>
</span><span id="LCCML.fit-156"><a href="#LCCML.fit-156"><span class="linenos">156</span></a><span class="sd">        y : pd.DataFrame</span>
</span><span id="LCCML.fit-157"><a href="#LCCML.fit-157"><span class="linenos">157</span></a><span class="sd">            Multi-label target matrix of shape (n_samples, n_labels), where columns correspond to label names.</span>
</span><span id="LCCML.fit-158"><a href="#LCCML.fit-158"><span class="linenos">158</span></a><span class="sd">        </span>
</span><span id="LCCML.fit-159"><a href="#LCCML.fit-159"><span class="linenos">159</span></a><span class="sd">        clusters : list of list of str</span>
</span><span id="LCCML.fit-160"><a href="#LCCML.fit-160"><span class="linenos">160</span></a><span class="sd">            Each sublist contains the names of labels belonging to one cluster.</span>
</span><span id="LCCML.fit-161"><a href="#LCCML.fit-161"><span class="linenos">161</span></a><span class="sd">            Example: [[&#39;label1&#39;, &#39;label2&#39;], [&#39;label3&#39;], [&#39;label4&#39;, &#39;label5&#39;]].</span>
</span><span id="LCCML.fit-162"><a href="#LCCML.fit-162"><span class="linenos">162</span></a>
</span><span id="LCCML.fit-163"><a href="#LCCML.fit-163"><span class="linenos">163</span></a><span class="sd">        Returns</span>
</span><span id="LCCML.fit-164"><a href="#LCCML.fit-164"><span class="linenos">164</span></a><span class="sd">        -------</span>
</span><span id="LCCML.fit-165"><a href="#LCCML.fit-165"><span class="linenos">165</span></a><span class="sd">        None</span>
</span><span id="LCCML.fit-166"><a href="#LCCML.fit-166"><span class="linenos">166</span></a>
</span><span id="LCCML.fit-167"><a href="#LCCML.fit-167"><span class="linenos">167</span></a><span class="sd">        Example</span>
</span><span id="LCCML.fit-168"><a href="#LCCML.fit-168"><span class="linenos">168</span></a><span class="sd">        -------</span>
</span><span id="LCCML.fit-169"><a href="#LCCML.fit-169"><span class="linenos">169</span></a><span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestClassifier</span>
</span><span id="LCCML.fit-170"><a href="#LCCML.fit-170"><span class="linenos">170</span></a><span class="sd">        &gt;&gt;&gt; model = RandomForestClassifier()</span>
</span><span id="LCCML.fit-171"><a href="#LCCML.fit-171"><span class="linenos">171</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=model, n_chains=5)</span>
</span><span id="LCCML.fit-172"><a href="#LCCML.fit-172"><span class="linenos">172</span></a>
</span><span id="LCCML.fit-173"><a href="#LCCML.fit-173"><span class="linenos">173</span></a><span class="sd">        &gt;&gt;&gt; # Suppose X_train is a pandas DataFrame of features, and Y_train is a pandas DataFrame of labels</span>
</span><span id="LCCML.fit-174"><a href="#LCCML.fit-174"><span class="linenos">174</span></a><span class="sd">        &gt;&gt;&gt; clusters = [[&#39;label_a&#39;, &#39;label_b&#39;], [&#39;label_c&#39;], [&#39;label_d&#39;, &#39;label_e&#39;]]</span>
</span><span id="LCCML.fit-175"><a href="#LCCML.fit-175"><span class="linenos">175</span></a><span class="sd">        &gt;&gt;&gt; lccml.fit(X_train, Y_train, clusters)</span>
</span><span id="LCCML.fit-176"><a href="#LCCML.fit-176"><span class="linenos">176</span></a>
</span><span id="LCCML.fit-177"><a href="#LCCML.fit-177"><span class="linenos">177</span></a><span class="sd">        After fitting, you can access:</span>
</span><span id="LCCML.fit-178"><a href="#LCCML.fit-178"><span class="linenos">178</span></a><span class="sd">        &gt;&gt;&gt; lccml.train_time_total  # total training time</span>
</span><span id="LCCML.fit-179"><a href="#LCCML.fit-179"><span class="linenos">179</span></a><span class="sd">        &gt;&gt;&gt; lccml.chain_train_times # list of training times per chain</span>
</span><span id="LCCML.fit-180"><a href="#LCCML.fit-180"><span class="linenos">180</span></a><span class="sd">        &gt;&gt;&gt; lccml.total_model_size  # total model size (bytes)</span>
</span><span id="LCCML.fit-181"><a href="#LCCML.fit-181"><span class="linenos">181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCCML.fit-182"><a href="#LCCML.fit-182"><span class="linenos">182</span></a>        
</span><span id="LCCML.fit-183"><a href="#LCCML.fit-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__generateOrders</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">))</span>
</span><span id="LCCML.fit-184"><a href="#LCCML.fit-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__preprocessClustersName</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>        
</span><span id="LCCML.fit-185"><a href="#LCCML.fit-185"><span class="linenos">185</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span><span class="p">):</span>
</span><span id="LCCML.fit-186"><a href="#LCCML.fit-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__fitChain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orders</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="LCCML.fit-187"><a href="#LCCML.fit-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_time_total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_train_times</span><span class="p">)</span>
</span><span id="LCCML.fit-188"><a href="#LCCML.fit-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_model_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_model_sizes</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Train the ensemble of label clusters chains.</p>

<p>This method trains multiple classifier chains. Each chain follows a random 
permutation of the provided label clusters. The model uses the predictions 
of previous clusters as additional features when training subsequent clusters.</p>

<h2 id="parameters">Parameters</h2>

<p>x : pd.DataFrame
    Feature matrix of shape (n_samples, n_features).</p>

<p>y : pd.DataFrame
    Multi-label target matrix of shape (n_samples, n_labels), where columns correspond to label names.</p>

<p>clusters : list of list of str
    Each sublist contains the names of labels belonging to one cluster.
    Example: [['label1', 'label2'], ['label3'], ['label4', 'label5']].</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lccml</span> <span class="o">=</span> <span class="n">LCCML</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">n_chains</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Suppose X_train is a pandas DataFrame of features, and Y_train is a pandas DataFrame of labels</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clusters</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;label_a&#39;</span><span class="p">,</span> <span class="s1">&#39;label_b&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;label_c&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;label_d&#39;</span><span class="p">,</span> <span class="s1">&#39;label_e&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lccml</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">clusters</span><span class="p">)</span>
</code></pre>
</div>

<p>After fitting, you can access:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">lccml</span><span class="o">.</span><span class="n">train_time_total</span>  <span class="c1"># total training time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lccml</span><span class="o">.</span><span class="n">chain_train_times</span> <span class="c1"># list of training times per chain</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lccml</span><span class="o">.</span><span class="n">total_model_size</span>  <span class="c1"># total model size (bytes)</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="LCCML.predict" class="classattr">
                                        <input id="LCCML.predict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">predict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LCCML.predict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCCML.predict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCCML.predict-452"><a href="#LCCML.predict-452"><span class="linenos">452</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="LCCML.predict-453"><a href="#LCCML.predict-453"><span class="linenos">453</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCCML.predict-454"><a href="#LCCML.predict-454"><span class="linenos">454</span></a><span class="sd">        Performs model prediction by aggregating the results from multiple chains.</span>
</span><span id="LCCML.predict-455"><a href="#LCCML.predict-455"><span class="linenos">455</span></a>
</span><span id="LCCML.predict-456"><a href="#LCCML.predict-456"><span class="linenos">456</span></a><span class="sd">        For each chain, the model sequentially predicts the clusters according to its specific order.</span>
</span><span id="LCCML.predict-457"><a href="#LCCML.predict-457"><span class="linenos">457</span></a><span class="sd">        The individual predictions from all chains are aggregated by averaging the predictions </span>
</span><span id="LCCML.predict-458"><a href="#LCCML.predict-458"><span class="linenos">458</span></a><span class="sd">        across chains for each label. This produces probabilistic predictions for each label.</span>
</span><span id="LCCML.predict-459"><a href="#LCCML.predict-459"><span class="linenos">459</span></a>
</span><span id="LCCML.predict-460"><a href="#LCCML.predict-460"><span class="linenos">460</span></a><span class="sd">        Parameters</span>
</span><span id="LCCML.predict-461"><a href="#LCCML.predict-461"><span class="linenos">461</span></a><span class="sd">        ----------</span>
</span><span id="LCCML.predict-462"><a href="#LCCML.predict-462"><span class="linenos">462</span></a><span class="sd">        x : pd.DataFrame</span>
</span><span id="LCCML.predict-463"><a href="#LCCML.predict-463"><span class="linenos">463</span></a><span class="sd">            DataFrame containing the input data (features) for prediction.</span>
</span><span id="LCCML.predict-464"><a href="#LCCML.predict-464"><span class="linenos">464</span></a><span class="sd">            Shape: (n_samples, n_features)</span>
</span><span id="LCCML.predict-465"><a href="#LCCML.predict-465"><span class="linenos">465</span></a>
</span><span id="LCCML.predict-466"><a href="#LCCML.predict-466"><span class="linenos">466</span></a><span class="sd">        Returns</span>
</span><span id="LCCML.predict-467"><a href="#LCCML.predict-467"><span class="linenos">467</span></a><span class="sd">        -------</span>
</span><span id="LCCML.predict-468"><a href="#LCCML.predict-468"><span class="linenos">468</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="LCCML.predict-469"><a href="#LCCML.predict-469"><span class="linenos">469</span></a><span class="sd">            DataFrame containing the aggregated predicted probabilities for each label.</span>
</span><span id="LCCML.predict-470"><a href="#LCCML.predict-470"><span class="linenos">470</span></a><span class="sd">            Shape: (n_samples, n_labels)</span>
</span><span id="LCCML.predict-471"><a href="#LCCML.predict-471"><span class="linenos">471</span></a><span class="sd">            The columns match the label names used during training.</span>
</span><span id="LCCML.predict-472"><a href="#LCCML.predict-472"><span class="linenos">472</span></a>
</span><span id="LCCML.predict-473"><a href="#LCCML.predict-473"><span class="linenos">473</span></a><span class="sd">        Example</span>
</span><span id="LCCML.predict-474"><a href="#LCCML.predict-474"><span class="linenos">474</span></a><span class="sd">        -------</span>
</span><span id="LCCML.predict-475"><a href="#LCCML.predict-475"><span class="linenos">475</span></a><span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestClassifier</span>
</span><span id="LCCML.predict-476"><a href="#LCCML.predict-476"><span class="linenos">476</span></a><span class="sd">        &gt;&gt;&gt; model = RandomForestClassifier()</span>
</span><span id="LCCML.predict-477"><a href="#LCCML.predict-477"><span class="linenos">477</span></a><span class="sd">        &gt;&gt;&gt; lccml = LCCML(model=model, n_chains=5)</span>
</span><span id="LCCML.predict-478"><a href="#LCCML.predict-478"><span class="linenos">478</span></a><span class="sd">        &gt;&gt;&gt; clusters = [[&#39;label_a&#39;, &#39;label_b&#39;], [&#39;label_c&#39;], [&#39;label_d&#39;, &#39;label_e&#39;]]</span>
</span><span id="LCCML.predict-479"><a href="#LCCML.predict-479"><span class="linenos">479</span></a><span class="sd">        &gt;&gt;&gt; lccml.fit(X_train, Y_train, clusters)</span>
</span><span id="LCCML.predict-480"><a href="#LCCML.predict-480"><span class="linenos">480</span></a><span class="sd">        &gt;&gt;&gt; Y_pred = lccml.predict(X_test)</span>
</span><span id="LCCML.predict-481"><a href="#LCCML.predict-481"><span class="linenos">481</span></a><span class="sd">        &gt;&gt;&gt; print(Y_pred.head())</span>
</span><span id="LCCML.predict-482"><a href="#LCCML.predict-482"><span class="linenos">482</span></a><span class="sd">        amazed.suprised  happy.pleased  relaxing.calm  quiet.still  ... angry.aggresive</span>
</span><span id="LCCML.predict-483"><a href="#LCCML.predict-483"><span class="linenos">483</span></a>
</span><span id="LCCML.predict-484"><a href="#LCCML.predict-484"><span class="linenos">484</span></a><span class="sd">        Notes</span>
</span><span id="LCCML.predict-485"><a href="#LCCML.predict-485"><span class="linenos">485</span></a><span class="sd">        -----</span>
</span><span id="LCCML.predict-486"><a href="#LCCML.predict-486"><span class="linenos">486</span></a><span class="sd">        - The aggregation is performed by computing the mean across predictions from all chains.</span>
</span><span id="LCCML.predict-487"><a href="#LCCML.predict-487"><span class="linenos">487</span></a><span class="sd">        - In case of any error during prediction, an exception will be printed.</span>
</span><span id="LCCML.predict-488"><a href="#LCCML.predict-488"><span class="linenos">488</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCCML.predict-489"><a href="#LCCML.predict-489"><span class="linenos">489</span></a>        <span class="c1"># Performs predictions for each of the chains, using __predictChain for each chain index (0 to n_chains-1)</span>
</span><span id="LCCML.predict-490"><a href="#LCCML.predict-490"><span class="linenos">490</span></a>        <span class="c1"># The result of each chain is concatenated along axis 0 (stacked vertically).</span>
</span><span id="LCCML.predict-491"><a href="#LCCML.predict-491"><span class="linenos">491</span></a>        <span class="c1"># predictions = pd.concat([self.__predictChain(x, i) for i in range(self.n_chains)], axis=0)        </span>
</span><span id="LCCML.predict-492"><a href="#LCCML.predict-492"><span class="linenos">492</span></a>        
</span><span id="LCCML.predict-493"><a href="#LCCML.predict-493"><span class="linenos">493</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LCCML.predict-494"><a href="#LCCML.predict-494"><span class="linenos">494</span></a>            <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">__predictChain</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="LCCML.predict-495"><a href="#LCCML.predict-495"><span class="linenos">495</span></a>            <span class="c1"># print(&quot;PREDICTIONS INSIDE PREDICT 2 before applying the mean&quot;)</span>
</span><span id="LCCML.predict-496"><a href="#LCCML.predict-496"><span class="linenos">496</span></a>            <span class="c1"># print(predictions)</span>
</span><span id="LCCML.predict-497"><a href="#LCCML.predict-497"><span class="linenos">497</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LCCML.predict-498"><a href="#LCCML.predict-498"><span class="linenos">498</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LCCML.predict-499"><a href="#LCCML.predict-499"><span class="linenos">499</span></a>        
</span><span id="LCCML.predict-500"><a href="#LCCML.predict-500"><span class="linenos">500</span></a>        <span class="n">predictions_aggregated</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="LCCML.predict-501"><a href="#LCCML.predict-501"><span class="linenos">501</span></a>        <span class="c1"># print(&quot;AGGREGATED PREDICTIONS:&quot;)</span>
</span><span id="LCCML.predict-502"><a href="#LCCML.predict-502"><span class="linenos">502</span></a>        <span class="c1"># print(predictions_aggregated)</span>
</span><span id="LCCML.predict-503"><a href="#LCCML.predict-503"><span class="linenos">503</span></a>
</span><span id="LCCML.predict-504"><a href="#LCCML.predict-504"><span class="linenos">504</span></a>        <span class="c1"># Now, for each class (column) in the DataFrame, compute the mean of the </span>
</span><span id="LCCML.predict-505"><a href="#LCCML.predict-505"><span class="linenos">505</span></a>        <span class="c1"># predictions for each group of examples (rows)</span>
</span><span id="LCCML.predict-506"><a href="#LCCML.predict-506"><span class="linenos">506</span></a>        <span class="c1"># We group by rows (index), and for each group (class), apply the mean        </span>
</span><span id="LCCML.predict-507"><a href="#LCCML.predict-507"><span class="linenos">507</span></a>        <span class="c1"># return predictions.groupby(predictions.index).apply(np.mean)</span>
</span><span id="LCCML.predict-508"><a href="#LCCML.predict-508"><span class="linenos">508</span></a>        <span class="c1"># predictions.mean(axis=0)  # Computes the mean per label (column)</span>
</span><span id="LCCML.predict-509"><a href="#LCCML.predict-509"><span class="linenos">509</span></a>
</span><span id="LCCML.predict-510"><a href="#LCCML.predict-510"><span class="linenos">510</span></a>        <span class="c1"># Now, for each sample, we select the highest prediction across chains</span>
</span><span id="LCCML.predict-511"><a href="#LCCML.predict-511"><span class="linenos">511</span></a>        <span class="c1"># We group by samples (index), and for each group (class), apply the max</span>
</span><span id="LCCML.predict-512"><a href="#LCCML.predict-512"><span class="linenos">512</span></a>        <span class="c1"># predictions_aggregated = predictions.groupby(predictions.index).max()</span>
</span><span id="LCCML.predict-513"><a href="#LCCML.predict-513"><span class="linenos">513</span></a>
</span><span id="LCCML.predict-514"><a href="#LCCML.predict-514"><span class="linenos">514</span></a>        <span class="k">return</span> <span class="n">predictions_aggregated</span>
</span></pre></div>


            <div class="docstring"><p>Performs model prediction by aggregating the results from multiple chains.</p>

<p>For each chain, the model sequentially predicts the clusters according to its specific order.
The individual predictions from all chains are aggregated by averaging the predictions 
across chains for each label. This produces probabilistic predictions for each label.</p>

<h2 id="parameters">Parameters</h2>

<p>x : pd.DataFrame
    DataFrame containing the input data (features) for prediction.
    Shape: (n_samples, n_features)</p>

<h2 id="returns">Returns</h2>

<p>pd.DataFrame
    DataFrame containing the aggregated predicted probabilities for each label.
    Shape: (n_samples, n_labels)
    The columns match the label names used during training.</p>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lccml</span> <span class="o">=</span> <span class="n">LCCML</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">n_chains</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clusters</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;label_a&#39;</span><span class="p">,</span> <span class="s1">&#39;label_b&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;label_c&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;label_d&#39;</span><span class="p">,</span> <span class="s1">&#39;label_e&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lccml</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">clusters</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y_pred</span> <span class="o">=</span> <span class="n">lccml</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">Y_pred</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">amazed.suprised  happy.pleased  relaxing.calm  quiet.still  ... angry.aggresive</span>
</code></pre>
</div>

<h2 id="notes">Notes</h2>

<ul>
<li>The aggregation is performed by computing the mean across predictions from all chains.</li>
<li>In case of any error during prediction, an exception will be printed.</li>
</ul>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>